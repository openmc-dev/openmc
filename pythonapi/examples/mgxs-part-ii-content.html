<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generate Input Files &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMC Documentation" href="../../index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner">
        <a href="../../index.html">
          <img class="logo" src="../../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <p>This IPython Notebook illustrates the use of the <code class="docutils literal"><span class="pre">openmc.mgxs</span></code> module
to calculate multi-group cross sections for a heterogeneous fuel pin
cell geometry. In particular, this Notebook illustrates the following
features:</p>
<ul class="simple">
<li>Creation of multi-group cross sections on a <strong>heterogeneous
geometry</strong></li>
<li>Calculation of cross sections on a <strong>nuclide-by-nuclide basis</strong></li>
<li>The use of <strong>`tally precision
triggers &lt;https://mit-crpg.github.io/openmc/usersguide/input.html#trigger-element&gt;`__</strong>
with multi-group cross sections</li>
<li>Built-in features for <strong>energy condensation</strong> in downstream data
processing</li>
<li>The use of <strong>`PyNE &lt;http://pyne.io/&gt;`__ to plot</strong> continuous-energy
vs. multi-group cross sections</li>
<li><strong>Validation</strong> of multi-group cross sections with
<strong>`OpenMOC &lt;https://mit-crpg.github.io/OpenMOC/&gt;`__</strong></li>
</ul>
<p><strong>Note:</strong> This Notebook was created using
<a class="reference external" href="https://mit-crpg.github.io/OpenMOC/">OpenMOC</a> to verify the
multi-group cross-sections generated by OpenMC. In order to run this
Notebook in its entirety, you must have
<a class="reference external" href="https://mit-crpg.github.io/OpenMOC/">OpenMOC</a> installed on your
system, along with OpenCG to convert the OpenMC geometries into OpenMOC
geometries. In addition, this Notebook illustrates the use of
<a class="reference external" href="http://pandas.pydata.org/">Pandas</a> <code class="docutils literal"><span class="pre">DataFrames</span></code> to containerize
multi-group cross section data. We recommend using
<a class="reference external" href="http://pandas.pydata.org/">Pandas</a> &gt;v0.15.0 or later since OpenMC&#8217;s
Python API leverages the multi-indexing feature included in the most
recent releases of <a class="reference external" href="http://pandas.pydata.org/">Pandas</a>.</p>
<div class="section" id="generate-input-files">
<h1>Generate Input Files<a class="headerlink" href="#generate-input-files" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre>import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

import openmc
import openmc.mgxs as mgxs
import openmoc
from openmoc.compatible import get_openmoc_geometry
import pyne.ace

%matplotlib inline
</pre></div>
</div>
<pre class="literal-block">
/usr/lib/pymodules/python2.7/matplotlib/__init__.py:1173: UserWarning:  This call to matplotlib.use() has no effect
because the backend has already been chosen;
matplotlib.use() must be called <em>before</em> pylab, matplotlib.pyplot,
or matplotlib.backends is imported for the first time.

  warnings.warn(_use_error_msg)
/usr/local/lib/python2.7/dist-packages/IPython/kernel/__main__.py:9: QAWarning: pyne.rxname is not yet QA compliant.
/usr/local/lib/python2.7/dist-packages/IPython/kernel/__main__.py:9: QAWarning: pyne.ace is not yet QA compliant.
</pre>
<p>First we need to define materials that will be used in the problem.
Before defining a material, we must create nuclides that are used in the
material.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate some Nuclides</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;H-1&#39;</span><span class="p">)</span>
<span class="n">o16</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;O-16&#39;</span><span class="p">)</span>
<span class="n">u235</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-235&#39;</span><span class="p">)</span>
<span class="n">u238</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-238&#39;</span><span class="p">)</span>
<span class="n">zr90</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;Zr-90&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the nuclides we defined, we will now create three distinct
materials for water, clad and fuel.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># 1.6% enriched fuel</span>
<span class="n">fuel</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">10.31341</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u235</span><span class="p">,</span> <span class="mf">3.7503e-4</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u238</span><span class="p">,</span> <span class="mf">2.2625e-2</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">4.6007e-2</span><span class="p">)</span>

<span class="c"># borated water</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Borated Water&#39;</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">0.740582</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mf">4.9457e-2</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">2.4732e-2</span><span class="p">)</span>

<span class="c"># zircaloy</span>
<span class="n">zircaloy</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Zircaloy&#39;</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">6.55</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">zr90</span><span class="p">,</span> <span class="mf">7.2758e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>With our materials, we can now create a <code class="docutils literal"><span class="pre">MaterialsFile</span></code> object that
can be exported to an actual XML file.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a MaterialsFile, add Materials</span>
<span class="n">materials_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">MaterialsFile</span><span class="p">()</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">zircaloy</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">default_xs</span> <span class="o">=</span> <span class="s">&#39;71c&#39;</span>

<span class="c"># Export to &quot;materials.xml&quot;</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s move on to the geometry. Our problem will have three regions
for the fuel, the clad, and the surrounding coolant. The first step is
to create the bounding surfaces &#8211; in this case two cylinders and six
reflective planes.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create cylinders for the fuel and clad</span>
<span class="n">fuel_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.39218</span><span class="p">)</span>
<span class="n">clad_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.45720</span><span class="p">)</span>

<span class="c"># Create boundary planes to surround the geometry</span>
<span class="n">min_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">min_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">min_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the surfaces defined, we can now create cells that are defined by
intersections of half-spaces created by the surfaces.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a Universe to encapsulate a fuel pin</span>
<span class="n">pin_cell_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel Pin&#39;</span><span class="p">)</span>

<span class="c"># Create fuel Cell</span>
<span class="n">fuel_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">fuel</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">-</span><span class="n">fuel_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">fuel_cell</span><span class="p">)</span>

<span class="c"># Create a clad Cell</span>
<span class="n">clad_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Clad&#39;</span><span class="p">)</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">zircaloy</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">fuel_outer_radius</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">clad_cell</span><span class="p">)</span>

<span class="c"># Create a moderator Cell</span>
<span class="n">moderator_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Moderator&#39;</span><span class="p">)</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">water</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">moderator_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>OpenMC requires that there is a &#8220;root&#8221; universe. Let us create a root
cell that is filled by the pin cell universe and then assign it to the
root universe.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create root Cell</span>
<span class="n">root_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;root cell&#39;</span><span class="p">)</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">min_x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_x</span> <span class="o">&amp;</span> <span class="o">+</span><span class="n">min_y</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_y</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">pin_cell_universe</span>

<span class="c"># Create root Universe</span>
<span class="n">root_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">universe_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;root universe&#39;</span><span class="p">)</span>
<span class="n">root_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">root_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>We now must create a geometry that is assigned a root universe, put the
geometry into a <code class="docutils literal"><span class="pre">GeometryFile</span></code> object, and export it to XML.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create Geometry and set root Universe</span>
<span class="n">openmc_geometry</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Geometry</span><span class="p">()</span>
<span class="n">openmc_geometry</span><span class="o">.</span><span class="n">root_universe</span> <span class="o">=</span> <span class="n">root_universe</span>

<span class="c"># Instantiate a GeometryFile</span>
<span class="n">geometry_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">GeometryFile</span><span class="p">()</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">openmc_geometry</span>

<span class="c"># Export to &quot;geometry.xml&quot;</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, we must define simulation parameters. In this case, we will use 10
inactive batches and 190 active batches each with 10,000 particles.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># OpenMC simulation parameters</span>
<span class="n">batches</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">inactive</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">particles</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c"># Instantiate a SettingsFile</span>
<span class="n">settings_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">SettingsFile</span><span class="p">()</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">batches</span> <span class="o">=</span> <span class="n">batches</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">inactive</span> <span class="o">=</span> <span class="n">inactive</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="n">particles</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tallies&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">]</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">set_source_space</span><span class="p">(</span><span class="s">&#39;fission&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>

<span class="c"># Activate tally precision triggers</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">trigger_active</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">trigger_max_batches</span> <span class="o">=</span> <span class="n">settings_file</span><span class="o">.</span><span class="n">batches</span> <span class="o">*</span> <span class="mi">4</span>

<span class="c"># Export to &quot;settings.xml&quot;</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we are finally ready to make use of the <code class="docutils literal"><span class="pre">openmc.mgxs</span></code> module to
generate multi-group cross sections! First, let&#8217;s define &#8220;coarse&#8221;
2-group and &#8220;fine&#8221; 8-group structures using the built-in
<code class="docutils literal"><span class="pre">EnergyGroups</span></code> class.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a &quot;coarse&quot; 2-group EnergyGroups object</span>
<span class="n">coarse_groups</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">EnergyGroups</span><span class="p">()</span>
<span class="n">coarse_groups</span><span class="o">.</span><span class="n">group_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.625e-6</span><span class="p">,</span> <span class="mf">20.</span><span class="p">])</span>

<span class="c"># Instantiate a &quot;fine&quot; 8-group EnergyGroups object</span>
<span class="n">fine_groups</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">EnergyGroups</span><span class="p">()</span>
<span class="n">fine_groups</span><span class="o">.</span><span class="n">group_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.058e-6</span><span class="p">,</span> <span class="mf">0.14e-6</span><span class="p">,</span> <span class="mf">0.28e-6</span><span class="p">,</span>
                                    <span class="mf">0.625e-6</span><span class="p">,</span> <span class="mf">4.e-6</span><span class="p">,</span> <span class="mf">5.53e-3</span><span class="p">,</span> <span class="mf">821.e-3</span><span class="p">,</span> <span class="mf">20.</span><span class="p">])</span>
</pre></div>
</div>
<p>Now we will instantiate a variety of <code class="docutils literal"><span class="pre">MGXS</span></code> objects needed to run an
OpenMOC simulation to verify the accuracy of our cross sections. In
particular, we define transport, fission, nu-fission, nu-scatter and chi
cross sections for each of the three cells in the fuel pin with the
8-group structure as our energy groups.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract all Cells filled by Materials</span>
<span class="n">openmc_cells</span> <span class="o">=</span> <span class="n">openmc_geometry</span><span class="o">.</span><span class="n">get_all_material_cells</span><span class="p">()</span>

<span class="c"># Create dictionary to store multi-group cross sections for all cells</span>
<span class="n">xs_library</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># Instantiate 8-group cross sections for each cell</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmc_cells</span><span class="p">:</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;transport&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">TransportXS</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">fine_groups</span><span class="p">)</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;fission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">FissionXS</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">fine_groups</span><span class="p">)</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-fission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">NuFissionXS</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">fine_groups</span><span class="p">)</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-scatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">NuScatterMatrixXS</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">fine_groups</span><span class="p">)</span>
    <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;chi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgxs</span><span class="o">.</span><span class="n">Chi</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">fine_groups</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we showcase the use of OpenMC&#8217;s <a class="reference external" href="https://mit-crpg.github.io/openmc/usersguide/input.html#trigger-element">tally precision
trigger</a>
feature in conjunction with the <code class="docutils literal"><span class="pre">openmc.mgxs</span></code> module. In particular,
we will assign a tally trigger of 1E-2 on the standard deviation for
each of the tallies used to compute multi-group cross sections.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a tally trigger for +/- 0.01 on each tally used to compute the multi-group cross sections</span>
<span class="n">tally_trigger</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="s">&#39;std_dev&#39;</span><span class="p">,</span> <span class="mf">1E-2</span><span class="p">)</span>

<span class="c"># Add the tally trigger to each of the multi-group cross section tallies</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmc_cells</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">mgxs_type</span> <span class="ow">in</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>
        <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">mgxs_type</span><span class="p">]</span><span class="o">.</span><span class="n">tally_trigger</span> <span class="o">=</span> <span class="n">tally_trigger</span>
</pre></div>
</div>
<p>Now, we must loop over all cells to set the cross section domains to the
various cells - fuel, clad and moderator - included in the geometry. In
addition, we will set each cross section to tally cross sections on a
per-nuclide basis through the use of the <code class="docutils literal"><span class="pre">MGXS</span></code> class&#8217; boolean
<code class="docutils literal"><span class="pre">by_nuclide</span></code> instance attribute.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate an empty TalliesFile</span>
<span class="n">tallies_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">TalliesFile</span><span class="p">()</span>

<span class="c"># Iterate over all cells and cross section types</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmc_cells</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">rxn_type</span> <span class="ow">in</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>

        <span class="c"># Set the cross sections domain type to the cell</span>
        <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">rxn_type</span><span class="p">]</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">cell</span>
        <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">rxn_type</span><span class="p">]</span><span class="o">.</span><span class="n">domain_type</span> <span class="o">=</span> <span class="s">&#39;cell&#39;</span>

        <span class="c"># Tally cross sections by nuclide</span>
        <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">rxn_type</span><span class="p">]</span><span class="o">.</span><span class="n">by_nuclide</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Add OpenMC tallies to the tallies file for XML generation</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">rxn_type</span><span class="p">]</span><span class="o">.</span><span class="n">tallies</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">tallies_file</span><span class="o">.</span><span class="n">add_tally</span><span class="p">(</span><span class="n">tally</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Export to &quot;tallies.xml&quot;</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we a have a complete set of inputs, so we can go ahead and run our
simulation.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Run OpenMC</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Executor</span><span class="p">()</span>
<span class="n">executor</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mpi_procs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>       .d88888b.                             888b     d888  .d8888b.
      d88P&quot; &quot;Y88b                            8888b   d8888 d88P  Y88b
      888     888                            88888b.d88888 888    888
      888     888 88888b.   .d88b.  88888b.  888Y88888P888 888
      888     888 888 &quot;88b d8P  Y8b 888 &quot;88b 888 Y888P 888 888
      888     888 888  888 88888888 888  888 888  Y8P  888 888    888
      Y88b. .d88P 888 d88P Y8b.     888  888 888   &quot;   888 Y88b  d88P
       &quot;Y88888P&quot;  88888P&quot;   &quot;Y8888  888  888 888       888  &quot;Y8888P&quot;
__________________888______________________________________________________
                  888
                  888

      Copyright:      2011-2015 Massachusetts Institute of Technology
      License:        http://mit-crpg.github.io/openmc/license.html
      Version:        0.7.0
      Git SHA1:       c4b14a5ef87f004528d35cbf33fef3ed15a386ca
      Date/Time:      2015-12-02 09:13:42
      MPI Processes:  3

 ===========================================================================
 ========================&gt;     INITIALIZATION     &lt;=========================
 ===========================================================================

 Reading settings XML file...
 Reading cross sections XML file...
 Reading geometry XML file...
 Reading materials XML file...
 Reading tallies XML file...
 Building neighboring cells lists for each surface...
 Loading ACE cross section table: 92235.71c
 Loading ACE cross section table: 92238.71c
 Loading ACE cross section table: 8016.71c
 Loading ACE cross section table: 1001.71c
 Loading ACE cross section table: 40090.71c
 Maximum neutron transport energy: 20.0000 MeV for 92235.71c
 Initializing source particles...

 ===========================================================================
 ====================&gt;     K EIGENVALUE SIMULATION     &lt;====================
 ===========================================================================

  Bat./Gen.      k            Average k
  =========   ========   ====================
        1/1    1.22593
        2/1    1.24245
        3/1    1.24545
        4/1    1.21868
        5/1    1.22429
        6/1    1.22607
        7/1    1.21456
        8/1    1.23816
        9/1    1.25060
       10/1    1.22806
       11/1    1.19821
       12/1    1.19897    1.19859 +/- 0.00038
       13/1    1.22119    1.20612 +/- 0.00754
       14/1    1.20701    1.20634 +/- 0.00533
       15/1    1.24784    1.21464 +/- 0.00927
       16/1    1.22413    1.21622 +/- 0.00773
       17/1    1.25050    1.22112 +/- 0.00817
       18/1    1.22006    1.22099 +/- 0.00707
       19/1    1.22813    1.22178 +/- 0.00629
       20/1    1.22791    1.22239 +/- 0.00566
       21/1    1.22729    1.22284 +/- 0.00514
       22/1    1.19867    1.22083 +/- 0.00510
       23/1    1.23796    1.22214 +/- 0.00488
       24/1    1.22412    1.22228 +/- 0.00452
       25/1    1.22638    1.22256 +/- 0.00421
       26/1    1.22181    1.22251 +/- 0.00394
       27/1    1.19055    1.22063 +/- 0.00415
       28/1    1.20683    1.21986 +/- 0.00399
       29/1    1.21689    1.21971 +/- 0.00378
       30/1    1.23670    1.22056 +/- 0.00368
       31/1    1.21396    1.22024 +/- 0.00352
       32/1    1.21389    1.21995 +/- 0.00337
       33/1    1.24649    1.22111 +/- 0.00342
       34/1    1.23204    1.22156 +/- 0.00330
       35/1    1.20768    1.22101 +/- 0.00322
       36/1    1.22271    1.22107 +/- 0.00309
       37/1    1.21796    1.22096 +/- 0.00298
       38/1    1.23842    1.22158 +/- 0.00293
       39/1    1.23080    1.22190 +/- 0.00285
       40/1    1.23572    1.22236 +/- 0.00279
       41/1    1.21691    1.22218 +/- 0.00271
       42/1    1.24616    1.22293 +/- 0.00272
       43/1    1.21903    1.22282 +/- 0.00264
       44/1    1.22967    1.22302 +/- 0.00257
       45/1    1.22053    1.22295 +/- 0.00250
       46/1    1.24087    1.22344 +/- 0.00248
       47/1    1.20251    1.22288 +/- 0.00248
       48/1    1.20331    1.22236 +/- 0.00246
       49/1    1.22724    1.22249 +/- 0.00240
       50/1    1.24798    1.22313 +/- 0.00243
 Triggers unsatisfied, max unc./thresh. is 1.32110 for scatter-p1 in tally 10054
 The estimated number of batches is 80
 Creating state point statepoint.050.h5...
       51/1    1.22253    1.22311 +/- 0.00237
       52/1    1.24330    1.22359 +/- 0.00236
       53/1    1.23251    1.22380 +/- 0.00231
       54/1    1.21133    1.22352 +/- 0.00228
       55/1    1.24503    1.22399 +/- 0.00228
       56/1    1.22013    1.22391 +/- 0.00223
       57/1    1.23877    1.22423 +/- 0.00220
       58/1    1.23793    1.22451 +/- 0.00218
       59/1    1.21018    1.22422 +/- 0.00215
       60/1    1.22417    1.22422 +/- 0.00211
       61/1    1.23094    1.22435 +/- 0.00207
       62/1    1.23310    1.22452 +/- 0.00204
       63/1    1.22488    1.22453 +/- 0.00200
       64/1    1.22702    1.22457 +/- 0.00196
       65/1    1.18834    1.22391 +/- 0.00204
       66/1    1.23112    1.22404 +/- 0.00200
       67/1    1.21611    1.22390 +/- 0.00197
       68/1    1.22513    1.22392 +/- 0.00194
       69/1    1.21741    1.22381 +/- 0.00191
       70/1    1.22484    1.22383 +/- 0.00188
       71/1    1.19662    1.22338 +/- 0.00190
       72/1    1.23315    1.22354 +/- 0.00187
       73/1    1.22796    1.22361 +/- 0.00185
       74/1    1.21417    1.22346 +/- 0.00182
       75/1    1.21020    1.22326 +/- 0.00181
       76/1    1.23413    1.22343 +/- 0.00179
       77/1    1.22184    1.22340 +/- 0.00176
       78/1    1.20309    1.22310 +/- 0.00176
       79/1    1.23458    1.22327 +/- 0.00174
       80/1    1.20724    1.22304 +/- 0.00173
 Triggers satisfied for batch 80
 Creating state point statepoint.080.h5...

 ===========================================================================
 ======================&gt;     SIMULATION FINISHED     &lt;======================
 ===========================================================================


 =======================&gt;     TIMING STATISTICS     &lt;=======================

 Total time for initialization     =  7.5700E-01 seconds
   Reading cross sections          =  1.5800E-01 seconds
 Total time in simulation          =  1.4921E+02 seconds
   Time in transport only          =  1.4336E+02 seconds
   Time in inactive batches        =  8.6210E+00 seconds
   Time in active batches          =  1.4059E+02 seconds
   Time synchronizing fission bank =  5.6060E+00 seconds
     Sampling source sites         =  1.4000E-02 seconds
     SEND/RECV source sites        =  4.0000E-03 seconds
   Time accumulating tallies       =  6.0000E-03 seconds
 Total time for finalization       =  1.3000E-02 seconds
 Total time elapsed                =  1.5002E+02 seconds
 Calculation Rate (inactive)       =  11599.6 neutrons/second
 Calculation Rate (active)         =  2845.11 neutrons/second

 ============================&gt;     RESULTS     &lt;============================

 k-effective (Collision)     =  1.22327 +/-  0.00148
 k-effective (Track-length)  =  1.22304 +/-  0.00173
 k-effective (Absorption)    =  1.22407 +/-  0.00129
 Combined k-effective        =  1.22373 +/-  0.00113
 Leakage Fraction            =  0.00000 +/-  0.00000
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="tally-data-processing">
<h1>Tally Data Processing<a class="headerlink" href="#tally-data-processing" title="Permalink to this headline">¶</a></h1>
<p>Our simulation ran successfully and created statepoint and summary
output files. We begin our analysis by instantiating a <code class="docutils literal"><span class="pre">StatePoint</span></code>
object.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Load the last statepoint file</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">StatePoint</span><span class="p">(</span><span class="s">&#39;statepoint.080.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to the statepoint file, our simulation also created a
summary file which encapsulates information about the materials and
geometry. This is necessary for the <code class="docutils literal"><span class="pre">openmc.mgxs</span></code> module to properly
process the tally data. We first create a <code class="docutils literal"><span class="pre">Summary</span></code> object and link it
with the statepoint.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Load the summary file and link it with the statepoint</span>
<span class="n">su</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Summary</span><span class="p">(</span><span class="s">&#39;summary.h5&#39;</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">link_with_summary</span><span class="p">(</span><span class="n">su</span><span class="p">)</span>
</pre></div>
</div>
<p>The statepoint is now ready to be analyzed by our multi-group cross
sections. We simply have to load the tallies from the <code class="docutils literal"><span class="pre">StatePoint</span></code>
into each object as follows and our <code class="docutils literal"><span class="pre">MGXS</span></code> objects will compute the
cross sections for us under-the-hood.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Iterate over all cells and cross section types</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmc_cells</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">rxn_type</span> <span class="ow">in</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>
        <span class="n">xs_library</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">rxn_type</span><span class="p">]</span><span class="o">.</span><span class="n">load_from_statepoint</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p>That&#8217;s it! Our multi-group cross sections are now ready for the big
spotlight. This time we have cross sections in three distinct spatial
zones - fuel, clad and moderator - on a per-nuclide basis.</p>
</div>
<div class="section" id="extracting-and-storing-mgxs-data">
<h1>Extracting and Storing MGXS Data<a class="headerlink" href="#extracting-and-storing-mgxs-data" title="Permalink to this headline">¶</a></h1>
<p>Let&#8217;s first inspect one of our cross sections by printing it to the
screen as a microscopic cross section in units of barns.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nufission</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">fuel_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-fission&#39;</span><span class="p">]</span>
<span class="n">nufission</span><span class="o">.</span><span class="n">print_xs</span><span class="p">(</span><span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;micro&#39;</span><span class="p">,</span> <span class="n">nuclides</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;U-235&#39;</span><span class="p">,</span> <span class="s">&#39;U-238&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Multi-Group XS
    Reaction Type  =        nu-fission
    Domain Type    =        cell
    Domain ID      =        10000
    Nuclide        =        U-235
    Cross Sections [barns]:
            Group 1 [0.821      - 20.0      MeV]:   3.31e+00 +/- 1.88e-01%
            Group 2 [0.00553    - 0.821     MeV]:   3.97e+00 +/- 1.24e-01%
            Group 3 [4e-06      - 0.00553   MeV]:   5.50e+01 +/- 2.02e-01%
            Group 4 [6.25e-07   - 4e-06     MeV]:   8.83e+01 +/- 3.56e-01%
            Group 5 [2.8e-07    - 6.25e-07  MeV]:   2.90e+02 +/- 4.54e-01%
            Group 6 [1.4e-07    - 2.8e-07   MeV]:   4.49e+02 +/- 4.10e-01%
            Group 7 [5.8e-08    - 1.4e-07   MeV]:   6.87e+02 +/- 2.56e-01%
            Group 8 [0.0        - 5.8e-08   MeV]:   1.44e+03 +/- 2.82e-01%

    Nuclide        =        U-238
    Cross Sections [barns]:
            Group 1 [0.821      - 20.0      MeV]:   1.06e+00 +/- 2.30e-01%
            Group 2 [0.00553    - 0.821     MeV]:   1.21e-03 +/- 2.25e-01%
            Group 3 [4e-06      - 0.00553   MeV]:   5.82e-04 +/- 3.09e+00%
            Group 4 [6.25e-07   - 4e-06     MeV]:   6.54e-06 +/- 3.27e-01%
            Group 5 [2.8e-07    - 6.25e-07  MeV]:   1.07e-05 +/- 4.39e-01%
            Group 6 [1.4e-07    - 2.8e-07   MeV]:   1.55e-05 +/- 4.12e-01%
            Group 7 [5.8e-08    - 1.4e-07   MeV]:   2.30e-05 +/- 2.57e-01%
            Group 8 [0.0        - 5.8e-08   MeV]:   4.24e-05 +/- 2.81e-01%
</pre></div>
</div>
<p>Our multi-group cross sections are capable of summing across all
nuclides to provide us with macroscopic cross sections as well.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nufission</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">fuel_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-fission&#39;</span><span class="p">]</span>
<span class="n">nufission</span><span class="o">.</span><span class="n">print_xs</span><span class="p">(</span><span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;macro&#39;</span><span class="p">,</span> <span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Multi-Group XS
    Reaction Type  =        nu-fission
    Domain Type    =        cell
    Domain ID      =        10000
    Cross Sections [cm^-1]:
            Group 1 [0.821      - 20.0      MeV]:   2.52e-02 +/- 2.19e-01%
            Group 2 [0.00553    - 0.821     MeV]:   1.51e-03 +/- 1.22e-01%
            Group 3 [4e-06      - 0.00553   MeV]:   2.06e-02 +/- 2.02e-01%
            Group 4 [6.25e-07   - 4e-06     MeV]:   3.31e-02 +/- 3.56e-01%
            Group 5 [2.8e-07    - 6.25e-07  MeV]:   1.09e-01 +/- 4.54e-01%
            Group 6 [1.4e-07    - 2.8e-07   MeV]:   1.69e-01 +/- 4.10e-01%
            Group 7 [5.8e-08    - 1.4e-07   MeV]:   2.58e-01 +/- 2.56e-01%
            Group 8 [0.0        - 5.8e-08   MeV]:   5.40e-01 +/- 2.82e-01%
</pre></div>
</div>
<p>Although a printed report is nice, it is not scalable or flexible. Let&#8217;s
extract the microscopic cross section data for the moderator as a
<a class="reference external" href="http://pandas.pydata.org/">Pandas</a> <code class="docutils literal"><span class="pre">DataFrame</span></code> .</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nuscatter</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">moderator_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-scatter&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">nuscatter</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;micro&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell</th>
      <th>group in</th>
      <th>group out</th>
      <th>nuclide</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>126</th>
      <td>10002</td>
      <td>1</td>
      <td>1</td>
      <td>H-1</td>
      <td>0.234022</td>
      <td>0.003645</td>
    </tr>
    <tr>
      <th>127</th>
      <td>10002</td>
      <td>1</td>
      <td>1</td>
      <td>O-16</td>
      <td>1.560305</td>
      <td>0.006280</td>
    </tr>
    <tr>
      <th>124</th>
      <td>10002</td>
      <td>1</td>
      <td>2</td>
      <td>H-1</td>
      <td>1.588025</td>
      <td>0.002815</td>
    </tr>
    <tr>
      <th>125</th>
      <td>10002</td>
      <td>1</td>
      <td>2</td>
      <td>O-16</td>
      <td>0.285147</td>
      <td>0.001392</td>
    </tr>
    <tr>
      <th>122</th>
      <td>10002</td>
      <td>1</td>
      <td>3</td>
      <td>H-1</td>
      <td>0.010776</td>
      <td>0.000186</td>
    </tr>
    <tr>
      <th>123</th>
      <td>10002</td>
      <td>1</td>
      <td>3</td>
      <td>O-16</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>120</th>
      <td>10002</td>
      <td>1</td>
      <td>4</td>
      <td>H-1</td>
      <td>0.000023</td>
      <td>0.000010</td>
    </tr>
    <tr>
      <th>121</th>
      <td>10002</td>
      <td>1</td>
      <td>4</td>
      <td>O-16</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>118</th>
      <td>10002</td>
      <td>1</td>
      <td>5</td>
      <td>H-1</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>119</th>
      <td>10002</td>
      <td>1</td>
      <td>5</td>
      <td>O-16</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div><p>Next, we illustate how one can easily take multi-group cross sections
and condense them down to a coarser energy group structure. The <code class="docutils literal"><span class="pre">MGXS</span></code>
class includes a <code class="docutils literal"><span class="pre">get_condensed_xs(...)</span></code> method which takes an
<code class="docutils literal"><span class="pre">EnergyGroups</span></code> parameter with a coarse(r) group structure and returns
a new <code class="docutils literal"><span class="pre">MGXS</span></code> condensed to the coarse groups. We illustrate this
process below using the 2-group structure created earlier.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract the 16-group transport cross section for the fuel</span>
<span class="n">fine_xs</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">fuel_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;transport&#39;</span><span class="p">]</span>

<span class="c"># Condense to the 2-group structure</span>
<span class="n">condensed_xs</span> <span class="o">=</span> <span class="n">fine_xs</span><span class="o">.</span><span class="n">get_condensed_xs</span><span class="p">(</span><span class="n">coarse_groups</span><span class="p">)</span>
</pre></div>
</div>
<p>Group condensation is as simple as that! We now have a new coarse
2-group <code class="docutils literal"><span class="pre">TransportXS</span></code> in addition to our original 16-group
<code class="docutils literal"><span class="pre">TransportXS</span></code>. Let&#8217;s inspect the 2-group <code class="docutils literal"><span class="pre">TransportXS</span></code> by printing
it to the screen and extracting a Pandas <code class="docutils literal"><span class="pre">DataFrame</span></code> as we have
already learned how to do.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">condensed_xs</span><span class="o">.</span><span class="n">print_xs</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Multi-Group XS
    Reaction Type  =        transport
    Domain Type    =        cell
    Domain ID      =        10000
    Nuclide        =        U-235
    Cross Sections [cm^-1]:
            Group 1 [6.25e-07   - 20.0      MeV]:   7.81e-03 +/- 4.75e-01%
            Group 2 [0.0        - 6.25e-07  MeV]:   1.82e-01 +/- 1.89e-01%

    Nuclide        =        U-238
    Cross Sections [cm^-1]:
            Group 1 [6.25e-07   - 20.0      MeV]:   2.17e-01 +/- 1.31e-01%
            Group 2 [0.0        - 6.25e-07  MeV]:   2.53e-01 +/- 2.08e-01%

    Nuclide        =        O-16
    Cross Sections [cm^-1]:
            Group 1 [6.25e-07   - 20.0      MeV]:   1.45e-01 +/- 1.50e-01%
            Group 2 [0.0        - 6.25e-07  MeV]:   1.74e-01 +/- 2.66e-01%
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span> <span class="o">=</span> <span class="n">condensed_xs</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;micro&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell</th>
      <th>group in</th>
      <th>nuclide</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>10000</td>
      <td>1</td>
      <td>U-235</td>
      <td>20.828127</td>
      <td>0.098842</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10000</td>
      <td>1</td>
      <td>U-238</td>
      <td>9.582295</td>
      <td>0.012550</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10000</td>
      <td>1</td>
      <td>O-16</td>
      <td>3.157358</td>
      <td>0.004725</td>
    </tr>
    <tr>
      <th>0</th>
      <td>10000</td>
      <td>2</td>
      <td>U-235</td>
      <td>485.217649</td>
      <td>0.916465</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10000</td>
      <td>2</td>
      <td>U-238</td>
      <td>11.176081</td>
      <td>0.023196</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>2</td>
      <td>O-16</td>
      <td>3.788167</td>
      <td>0.010090</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="verification-with-openmoc">
<h1>Verification with OpenMOC<a class="headerlink" href="#verification-with-openmoc" title="Permalink to this headline">¶</a></h1>
<p>Now, let&#8217;s verify our cross sections using OpenMOC. First, we use OpenCG
construct an equivalent OpenMOC geometry.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create an OpenMOC Geometry from the OpenCG Geometry</span>
<span class="n">openmoc_geometry</span> <span class="o">=</span> <span class="n">get_openmoc_geometry</span><span class="p">(</span><span class="n">su</span><span class="o">.</span><span class="n">opencg_geometry</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we we can inject the multi-group cross sections into the
equivalent fuel pin cell OpenMOC geometry.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get all OpenMOC cells in the gometry</span>
<span class="n">openmoc_cells</span> <span class="o">=</span> <span class="n">openmoc_geometry</span><span class="o">.</span><span class="n">getRootUniverse</span><span class="p">()</span><span class="o">.</span><span class="n">getAllCells</span><span class="p">()</span>

<span class="c"># Inject multi-group cross sections into OpenMOC Materials</span>
<span class="k">for</span> <span class="n">cell_id</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmoc_cells</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="c"># Ignore the root cell</span>
    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;root cell&#39;</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c"># Get a reference to the Material filling this Cell</span>
    <span class="n">openmoc_material</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">getFillMaterial</span><span class="p">()</span>

    <span class="c"># Set the number of energy groups for the Material</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setNumEnergyGroups</span><span class="p">(</span><span class="n">fine_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">)</span>

    <span class="c"># Extract the appropriate cross section objects for this cell</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;transport&#39;</span><span class="p">]</span>
    <span class="n">nufission</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;nu-fission&#39;</span><span class="p">]</span>
    <span class="n">nuscatter</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;nu-scatter&#39;</span><span class="p">]</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;chi&#39;</span><span class="p">]</span>

    <span class="c"># Inject NumPy arrays of cross section data into the Material</span>
    <span class="c"># NOTE: Sum across nuclides to get macro cross sections needed by OpenMOC</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setSigmaT</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setNuSigmaF</span><span class="p">(</span><span class="n">nufission</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setSigmaS</span><span class="p">(</span><span class="n">nuscatter</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setChi</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</pre></div>
</div>
<p>We are now ready to run OpenMOC to verify our cross-sections from
OpenMC.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Generate tracks for OpenMOC</span>
<span class="n">openmoc_geometry</span><span class="o">.</span><span class="n">initializeFlatSourceRegions</span><span class="p">()</span>
<span class="n">track_generator</span> <span class="o">=</span> <span class="n">openmoc</span><span class="o">.</span><span class="n">TrackGenerator</span><span class="p">(</span><span class="n">openmoc_geometry</span><span class="p">,</span> <span class="n">num_azim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">track_generator</span><span class="o">.</span><span class="n">generateTracks</span><span class="p">()</span>

<span class="c"># Run OpenMOC</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">openmoc</span><span class="o">.</span><span class="n">CPUSolver</span><span class="p">(</span><span class="n">track_generator</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">computeEigenvalue</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[  NORMAL ]  Importing ray tracing data from file...
[  NORMAL ]  Computing the eigenvalue...
[  NORMAL ]  Iteration 0:   k_eff = 0.574633        res = 1.959E-316
[  NORMAL ]  Iteration 1:   k_eff = 0.679931        res = 4.254E-01
[  NORMAL ]  Iteration 2:   k_eff = 0.660910        res = 1.832E-01
[  NORMAL ]  Iteration 3:   k_eff = 0.658975        res = 2.797E-02
[  NORMAL ]  Iteration 4:   k_eff = 0.642976        res = 2.928E-03
[  NORMAL ]  Iteration 5:   k_eff = 0.625710        res = 2.428E-02
[  NORMAL ]  Iteration 6:   k_eff = 0.606520        res = 2.685E-02
[  NORMAL ]  Iteration 7:   k_eff = 0.587277        res = 3.067E-02
[  NORMAL ]  Iteration 8:   k_eff = 0.568777        res = 3.173E-02
[  NORMAL ]  Iteration 9:   k_eff = 0.551415        res = 3.150E-02
[  NORMAL ]  Iteration 10:  k_eff = 0.535708        res = 3.052E-02
[  NORMAL ]  Iteration 11:  k_eff = 0.521916        res = 2.849E-02
[  NORMAL ]  Iteration 12:  k_eff = 0.510221        res = 2.575E-02
[  NORMAL ]  Iteration 13:  k_eff = 0.500691        res = 2.241E-02
[  NORMAL ]  Iteration 14:  k_eff = 0.493392        res = 1.868E-02
[  NORMAL ]  Iteration 15:  k_eff = 0.488317        res = 1.458E-02
[  NORMAL ]  Iteration 16:  k_eff = 0.485438        res = 1.028E-02
[  NORMAL ]  Iteration 17:  k_eff = 0.484705        res = 5.896E-03
[  NORMAL ]  Iteration 18:  k_eff = 0.486045        res = 1.510E-03
[  NORMAL ]  Iteration 19:  k_eff = 0.489362        res = 2.766E-03
[  NORMAL ]  Iteration 20:  k_eff = 0.494546        res = 6.824E-03
[  NORMAL ]  Iteration 21:  k_eff = 0.501481        res = 1.059E-02
[  NORMAL ]  Iteration 22:  k_eff = 0.510041        res = 1.402E-02
[  NORMAL ]  Iteration 23:  k_eff = 0.520094        res = 1.707E-02
[  NORMAL ]  Iteration 24:  k_eff = 0.531507        res = 1.971E-02
[  NORMAL ]  Iteration 25:  k_eff = 0.544144        res = 2.194E-02
[  NORMAL ]  Iteration 26:  k_eff = 0.557872        res = 2.378E-02
[  NORMAL ]  Iteration 27:  k_eff = 0.572557        res = 2.523E-02
[  NORMAL ]  Iteration 28:  k_eff = 0.588072        res = 2.632E-02
[  NORMAL ]  Iteration 29:  k_eff = 0.604293        res = 2.710E-02
[  NORMAL ]  Iteration 30:  k_eff = 0.621101        res = 2.758E-02
[  NORMAL ]  Iteration 31:  k_eff = 0.638382        res = 2.781E-02
[  NORMAL ]  Iteration 32:  k_eff = 0.656032        res = 2.782E-02
[  NORMAL ]  Iteration 33:  k_eff = 0.673950        res = 2.765E-02
[  NORMAL ]  Iteration 34:  k_eff = 0.692043        res = 2.731E-02
[  NORMAL ]  Iteration 35:  k_eff = 0.710227        res = 2.685E-02
[  NORMAL ]  Iteration 36:  k_eff = 0.728423        res = 2.628E-02
[  NORMAL ]  Iteration 37:  k_eff = 0.746558        res = 2.562E-02
[  NORMAL ]  Iteration 38:  k_eff = 0.764569        res = 2.490E-02
[  NORMAL ]  Iteration 39:  k_eff = 0.782396        res = 2.412E-02
[  NORMAL ]  Iteration 40:  k_eff = 0.799989        res = 2.332E-02
[  NORMAL ]  Iteration 41:  k_eff = 0.817301        res = 2.249E-02
[  NORMAL ]  Iteration 42:  k_eff = 0.834292        res = 2.164E-02
[  NORMAL ]  Iteration 43:  k_eff = 0.850927        res = 2.079E-02
[  NORMAL ]  Iteration 44:  k_eff = 0.867177        res = 1.994E-02
[  NORMAL ]  Iteration 45:  k_eff = 0.883017        res = 1.910E-02
[  NORMAL ]  Iteration 46:  k_eff = 0.898427        res = 1.827E-02
[  NORMAL ]  Iteration 47:  k_eff = 0.913389        res = 1.745E-02
[  NORMAL ]  Iteration 48:  k_eff = 0.927891        res = 1.665E-02
[  NORMAL ]  Iteration 49:  k_eff = 0.941925        res = 1.588E-02
[  NORMAL ]  Iteration 50:  k_eff = 0.955483        res = 1.512E-02
[  NORMAL ]  Iteration 51:  k_eff = 0.968562        res = 1.439E-02
[  NORMAL ]  Iteration 52:  k_eff = 0.981161        res = 1.369E-02
[  NORMAL ]  Iteration 53:  k_eff = 0.993282        res = 1.301E-02
[  NORMAL ]  Iteration 54:  k_eff = 1.004928        res = 1.235E-02
[  NORMAL ]  Iteration 55:  k_eff = 1.016104        res = 1.172E-02
[  NORMAL ]  Iteration 56:  k_eff = 1.026816        res = 1.112E-02
[  NORMAL ]  Iteration 57:  k_eff = 1.037073        res = 1.054E-02
[  NORMAL ]  Iteration 58:  k_eff = 1.046883        res = 9.989E-03
[  NORMAL ]  Iteration 59:  k_eff = 1.056257        res = 9.460E-03
[  NORMAL ]  Iteration 60:  k_eff = 1.065205        res = 8.954E-03
[  NORMAL ]  Iteration 61:  k_eff = 1.073739        res = 8.472E-03
[  NORMAL ]  Iteration 62:  k_eff = 1.081871        res = 8.012E-03
[  NORMAL ]  Iteration 63:  k_eff = 1.089613        res = 7.573E-03
[  NORMAL ]  Iteration 64:  k_eff = 1.096979        res = 7.156E-03
[  NORMAL ]  Iteration 65:  k_eff = 1.103980        res = 6.760E-03
[  NORMAL ]  Iteration 66:  k_eff = 1.110631        res = 6.382E-03
[  NORMAL ]  Iteration 67:  k_eff = 1.116943        res = 6.024E-03
[  NORMAL ]  Iteration 68:  k_eff = 1.122931        res = 5.684E-03
[  NORMAL ]  Iteration 69:  k_eff = 1.128607        res = 5.361E-03
[  NORMAL ]  Iteration 70:  k_eff = 1.133984        res = 5.055E-03
[  NORMAL ]  Iteration 71:  k_eff = 1.139075        res = 4.764E-03
[  NORMAL ]  Iteration 72:  k_eff = 1.143892        res = 4.489E-03
[  NORMAL ]  Iteration 73:  k_eff = 1.148447        res = 4.229E-03
[  NORMAL ]  Iteration 74:  k_eff = 1.152752        res = 3.982E-03
[  NORMAL ]  Iteration 75:  k_eff = 1.156819        res = 3.749E-03
[  NORMAL ]  Iteration 76:  k_eff = 1.160659        res = 3.528E-03
[  NORMAL ]  Iteration 77:  k_eff = 1.164282        res = 3.319E-03
[  NORMAL ]  Iteration 78:  k_eff = 1.167701        res = 3.122E-03
[  NORMAL ]  Iteration 79:  k_eff = 1.170923        res = 2.936E-03
[  NORMAL ]  Iteration 80:  k_eff = 1.173961        res = 2.760E-03
[  NORMAL ]  Iteration 81:  k_eff = 1.176822        res = 2.594E-03
[  NORMAL ]  Iteration 82:  k_eff = 1.179516        res = 2.437E-03
[  NORMAL ]  Iteration 83:  k_eff = 1.182052        res = 2.289E-03
[  NORMAL ]  Iteration 84:  k_eff = 1.184438        res = 2.150E-03
[  NORMAL ]  Iteration 85:  k_eff = 1.186682        res = 2.019E-03
[  NORMAL ]  Iteration 86:  k_eff = 1.188792        res = 1.895E-03
[  NORMAL ]  Iteration 87:  k_eff = 1.190775        res = 1.778E-03
[  NORMAL ]  Iteration 88:  k_eff = 1.192639        res = 1.668E-03
[  NORMAL ]  Iteration 89:  k_eff = 1.194389        res = 1.565E-03
[  NORMAL ]  Iteration 90:  k_eff = 1.196032        res = 1.468E-03
[  NORMAL ]  Iteration 91:  k_eff = 1.197575        res = 1.376E-03
[  NORMAL ]  Iteration 92:  k_eff = 1.199023        res = 1.290E-03
[  NORMAL ]  Iteration 93:  k_eff = 1.200381        res = 1.209E-03
[  NORMAL ]  Iteration 94:  k_eff = 1.201654        res = 1.133E-03
[  NORMAL ]  Iteration 95:  k_eff = 1.202849        res = 1.061E-03
[  NORMAL ]  Iteration 96:  k_eff = 1.203968        res = 9.939E-04
[  NORMAL ]  Iteration 97:  k_eff = 1.205017        res = 9.307E-04
[  NORMAL ]  Iteration 98:  k_eff = 1.206000        res = 8.714E-04
[  NORMAL ]  Iteration 99:  k_eff = 1.206921        res = 8.157E-04
[  NORMAL ]  Iteration 100: k_eff = 1.207783        res = 7.634E-04
[  NORMAL ]  Iteration 101: k_eff = 1.208590        res = 7.144E-04
[  NORMAL ]  Iteration 102: k_eff = 1.209346        res = 6.684E-04
[  NORMAL ]  Iteration 103: k_eff = 1.210053        res = 6.252E-04
[  NORMAL ]  Iteration 104: k_eff = 1.210715        res = 5.848E-04
[  NORMAL ]  Iteration 105: k_eff = 1.211334        res = 5.468E-04
[  NORMAL ]  Iteration 106: k_eff = 1.211913        res = 5.113E-04
[  NORMAL ]  Iteration 107: k_eff = 1.212454        res = 4.779E-04
[  NORMAL ]  Iteration 108: k_eff = 1.212960        res = 4.467E-04
[  NORMAL ]  Iteration 109: k_eff = 1.213434        res = 4.175E-04
[  NORMAL ]  Iteration 110: k_eff = 1.213876        res = 3.901E-04
[  NORMAL ]  Iteration 111: k_eff = 1.214289        res = 3.644E-04
[  NORMAL ]  Iteration 112: k_eff = 1.214675        res = 3.404E-04
[  NORMAL ]  Iteration 113: k_eff = 1.215036        res = 3.180E-04
[  NORMAL ]  Iteration 114: k_eff = 1.215373        res = 2.969E-04
[  NORMAL ]  Iteration 115: k_eff = 1.215687        res = 2.773E-04
[  NORMAL ]  Iteration 116: k_eff = 1.215981        res = 2.589E-04
[  NORMAL ]  Iteration 117: k_eff = 1.216255        res = 2.416E-04
[  NORMAL ]  Iteration 118: k_eff = 1.216511        res = 2.256E-04
[  NORMAL ]  Iteration 119: k_eff = 1.216750        res = 2.105E-04
[  NORMAL ]  Iteration 120: k_eff = 1.216973        res = 1.964E-04
[  NORMAL ]  Iteration 121: k_eff = 1.217181        res = 1.833E-04
[  NORMAL ]  Iteration 122: k_eff = 1.217376        res = 1.710E-04
[  NORMAL ]  Iteration 123: k_eff = 1.217557        res = 1.595E-04
[  NORMAL ]  Iteration 124: k_eff = 1.217726        res = 1.488E-04
[  NORMAL ]  Iteration 125: k_eff = 1.217883        res = 1.388E-04
[  NORMAL ]  Iteration 126: k_eff = 1.218030        res = 1.294E-04
[  NORMAL ]  Iteration 127: k_eff = 1.218167        res = 1.207E-04
[  NORMAL ]  Iteration 128: k_eff = 1.218295        res = 1.125E-04
[  NORMAL ]  Iteration 129: k_eff = 1.218414        res = 1.049E-04
[  NORMAL ]  Iteration 130: k_eff = 1.218525        res = 9.777E-05
[  NORMAL ]  Iteration 131: k_eff = 1.218629        res = 9.113E-05
[  NORMAL ]  Iteration 132: k_eff = 1.218725        res = 8.494E-05
[  NORMAL ]  Iteration 133: k_eff = 1.218815        res = 7.916E-05
[  NORMAL ]  Iteration 134: k_eff = 1.218899        res = 7.376E-05
[  NORMAL ]  Iteration 135: k_eff = 1.218977        res = 6.873E-05
[  NORMAL ]  Iteration 136: k_eff = 1.219050        res = 6.404E-05
[  NORMAL ]  Iteration 137: k_eff = 1.219117        res = 5.966E-05
[  NORMAL ]  Iteration 138: k_eff = 1.219180        res = 5.557E-05
[  NORMAL ]  Iteration 139: k_eff = 1.219239        res = 5.177E-05
[  NORMAL ]  Iteration 140: k_eff = 1.219294        res = 4.822E-05
[  NORMAL ]  Iteration 141: k_eff = 1.219345        res = 4.491E-05
[  NORMAL ]  Iteration 142: k_eff = 1.219392        res = 4.182E-05
[  NORMAL ]  Iteration 143: k_eff = 1.219437        res = 3.894E-05
[  NORMAL ]  Iteration 144: k_eff = 1.219478        res = 3.626E-05
[  NORMAL ]  Iteration 145: k_eff = 1.219516        res = 3.376E-05
[  NORMAL ]  Iteration 146: k_eff = 1.219552        res = 3.144E-05
[  NORMAL ]  Iteration 147: k_eff = 1.219585        res = 2.927E-05
[  NORMAL ]  Iteration 148: k_eff = 1.219616        res = 2.724E-05
[  NORMAL ]  Iteration 149: k_eff = 1.219645        res = 2.536E-05
[  NORMAL ]  Iteration 150: k_eff = 1.219672        res = 2.361E-05
[  NORMAL ]  Iteration 151: k_eff = 1.219696        res = 2.197E-05
[  NORMAL ]  Iteration 152: k_eff = 1.219720        res = 2.045E-05
[  NORMAL ]  Iteration 153: k_eff = 1.219741        res = 1.903E-05
[  NORMAL ]  Iteration 154: k_eff = 1.219761        res = 1.771E-05
[  NORMAL ]  Iteration 155: k_eff = 1.219780        res = 1.648E-05
[  NORMAL ]  Iteration 156: k_eff = 1.219797        res = 1.534E-05
[  NORMAL ]  Iteration 157: k_eff = 1.219814        res = 1.427E-05
[  NORMAL ]  Iteration 158: k_eff = 1.219829        res = 1.328E-05
[  NORMAL ]  Iteration 159: k_eff = 1.219843        res = 1.235E-05
[  NORMAL ]  Iteration 160: k_eff = 1.219856        res = 1.149E-05
[  NORMAL ]  Iteration 161: k_eff = 1.219868        res = 1.069E-05
</pre></div>
</div>
<p>We report the eigenvalues computed by OpenMC and OpenMOC here together
to summarize our results.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Print report of keff and bias with OpenMC</span>
<span class="n">openmoc_keff</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">getKeff</span><span class="p">()</span>
<span class="n">openmc_keff</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">k_combined</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bias</span> <span class="o">=</span> <span class="p">(</span><span class="n">openmoc_keff</span> <span class="o">-</span> <span class="n">openmc_keff</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e5</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;openmc keff = {0:1.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">openmc_keff</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;openmoc keff = {0:1.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">openmoc_keff</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;bias [pcm]: {0:1.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bias</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>openmc keff = 1.223729
openmoc keff = 1.219868
bias [pcm]: -386.1
</pre></div>
</div>
<p>As a sanity check, let&#8217;s run a simulation with the coarse 2-group cross
sections to ensure that they also produce a reasonable result.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">openmoc_geometry</span> <span class="o">=</span> <span class="n">get_openmoc_geometry</span><span class="p">(</span><span class="n">su</span><span class="o">.</span><span class="n">opencg_geometry</span><span class="p">)</span>
<span class="n">openmoc_cells</span> <span class="o">=</span> <span class="n">openmoc_geometry</span><span class="o">.</span><span class="n">getRootUniverse</span><span class="p">()</span><span class="o">.</span><span class="n">getAllCells</span><span class="p">()</span>

<span class="c"># Inject multi-group cross sections into OpenMOC Materials</span>
<span class="k">for</span> <span class="n">cell_id</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">openmoc_cells</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="c"># Ignore the root cell</span>
    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;root cell&#39;</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">openmoc_material</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">getFillMaterial</span><span class="p">()</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setNumEnergyGroups</span><span class="p">(</span><span class="n">coarse_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">)</span>

    <span class="c"># Extract the appropriate cross section objects for this cell</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;transport&#39;</span><span class="p">]</span>
    <span class="n">nufission</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;nu-fission&#39;</span><span class="p">]</span>
    <span class="n">nuscatter</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;nu-scatter&#39;</span><span class="p">]</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">cell_id</span><span class="p">][</span><span class="s">&#39;chi&#39;</span><span class="p">]</span>

    <span class="c"># Perform group condensation</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">transport</span><span class="o">.</span><span class="n">get_condensed_xs</span><span class="p">(</span><span class="n">coarse_groups</span><span class="p">)</span>
    <span class="n">nufission</span> <span class="o">=</span> <span class="n">nufission</span><span class="o">.</span><span class="n">get_condensed_xs</span><span class="p">(</span><span class="n">coarse_groups</span><span class="p">)</span>
    <span class="n">nuscatter</span> <span class="o">=</span> <span class="n">nuscatter</span><span class="o">.</span><span class="n">get_condensed_xs</span><span class="p">(</span><span class="n">coarse_groups</span><span class="p">)</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">get_condensed_xs</span><span class="p">(</span><span class="n">coarse_groups</span><span class="p">)</span>

    <span class="c"># Inject NumPy arrays of cross section data into the Material</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setSigmaT</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setNuSigmaF</span><span class="p">(</span><span class="n">nufission</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setSigmaS</span><span class="p">(</span><span class="n">nuscatter</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">openmoc_material</span><span class="o">.</span><span class="n">setChi</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Generate tracks for OpenMOC</span>
<span class="n">openmoc_geometry</span><span class="o">.</span><span class="n">initializeFlatSourceRegions</span><span class="p">()</span>
<span class="n">track_generator</span> <span class="o">=</span> <span class="n">openmoc</span><span class="o">.</span><span class="n">TrackGenerator</span><span class="p">(</span><span class="n">openmoc_geometry</span><span class="p">,</span> <span class="n">num_azim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">track_generator</span><span class="o">.</span><span class="n">generateTracks</span><span class="p">()</span>

<span class="c"># Run OpenMOC</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">openmoc</span><span class="o">.</span><span class="n">CPUSolver</span><span class="p">(</span><span class="n">track_generator</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">computeEigenvalue</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[  NORMAL ]  Importing ray tracing data from file...
[  NORMAL ]  Computing the eigenvalue...
[  NORMAL ]  Iteration 0:   k_eff = 0.495594        res = 1.959E-316
[  NORMAL ]  Iteration 1:   k_eff = 0.557312        res = 5.044E-01
[  NORMAL ]  Iteration 2:   k_eff = 0.518115        res = 1.245E-01
[  NORMAL ]  Iteration 3:   k_eff = 0.509016        res = 7.033E-02
[  NORMAL ]  Iteration 4:   k_eff = 0.496279        res = 1.756E-02
[  NORMAL ]  Iteration 5:   k_eff = 0.488357        res = 2.502E-02
[  NORMAL ]  Iteration 6:   k_eff = 0.482659        res = 1.596E-02
[  NORMAL ]  Iteration 7:   k_eff = 0.479523        res = 1.167E-02
[  NORMAL ]  Iteration 8:   k_eff = 0.478568        res = 6.497E-03
[  NORMAL ]  Iteration 9:   k_eff = 0.479590        res = 1.991E-03
[  NORMAL ]  Iteration 10:  k_eff = 0.482388        res = 2.136E-03
[  NORMAL ]  Iteration 11:  k_eff = 0.486774        res = 5.834E-03
[  NORMAL ]  Iteration 12:  k_eff = 0.492575        res = 9.091E-03
[  NORMAL ]  Iteration 13:  k_eff = 0.499632        res = 1.192E-02
[  NORMAL ]  Iteration 14:  k_eff = 0.507799        res = 1.433E-02
[  NORMAL ]  Iteration 15:  k_eff = 0.516943        res = 1.635E-02
[  NORMAL ]  Iteration 16:  k_eff = 0.526942        res = 1.801E-02
[  NORMAL ]  Iteration 17:  k_eff = 0.537681        res = 1.934E-02
[  NORMAL ]  Iteration 18:  k_eff = 0.549060        res = 2.038E-02
[  NORMAL ]  Iteration 19:  k_eff = 0.560984        res = 2.116E-02
[  NORMAL ]  Iteration 20:  k_eff = 0.573368        res = 2.172E-02
[  NORMAL ]  Iteration 21:  k_eff = 0.586133        res = 2.207E-02
[  NORMAL ]  Iteration 22:  k_eff = 0.599207        res = 2.226E-02
[  NORMAL ]  Iteration 23:  k_eff = 0.612528        res = 2.231E-02
[  NORMAL ]  Iteration 24:  k_eff = 0.626035        res = 2.223E-02
[  NORMAL ]  Iteration 25:  k_eff = 0.639676        res = 2.205E-02
[  NORMAL ]  Iteration 26:  k_eff = 0.653402        res = 2.179E-02
[  NORMAL ]  Iteration 27:  k_eff = 0.667170        res = 2.146E-02
[  NORMAL ]  Iteration 28:  k_eff = 0.680942        res = 2.107E-02
[  NORMAL ]  Iteration 29:  k_eff = 0.694681        res = 2.064E-02
[  NORMAL ]  Iteration 30:  k_eff = 0.708356        res = 2.018E-02
[  NORMAL ]  Iteration 31:  k_eff = 0.721940        res = 1.969E-02
[  NORMAL ]  Iteration 32:  k_eff = 0.735406        res = 1.918E-02
[  NORMAL ]  Iteration 33:  k_eff = 0.748734        res = 1.865E-02
[  NORMAL ]  Iteration 34:  k_eff = 0.761904        res = 1.812E-02
[  NORMAL ]  Iteration 35:  k_eff = 0.774897        res = 1.759E-02
[  NORMAL ]  Iteration 36:  k_eff = 0.787700        res = 1.705E-02
[  NORMAL ]  Iteration 37:  k_eff = 0.800299        res = 1.652E-02
[  NORMAL ]  Iteration 38:  k_eff = 0.812684        res = 1.600E-02
[  NORMAL ]  Iteration 39:  k_eff = 0.824844        res = 1.547E-02
[  NORMAL ]  Iteration 40:  k_eff = 0.836772        res = 1.496E-02
[  NORMAL ]  Iteration 41:  k_eff = 0.848462        res = 1.446E-02
[  NORMAL ]  Iteration 42:  k_eff = 0.859908        res = 1.397E-02
[  NORMAL ]  Iteration 43:  k_eff = 0.871105        res = 1.349E-02
[  NORMAL ]  Iteration 44:  k_eff = 0.882052        res = 1.302E-02
[  NORMAL ]  Iteration 45:  k_eff = 0.892745        res = 1.257E-02
[  NORMAL ]  Iteration 46:  k_eff = 0.903184        res = 1.212E-02
[  NORMAL ]  Iteration 47:  k_eff = 0.913367        res = 1.169E-02
[  NORMAL ]  Iteration 48:  k_eff = 0.923297        res = 1.128E-02
[  NORMAL ]  Iteration 49:  k_eff = 0.932972        res = 1.087E-02
[  NORMAL ]  Iteration 50:  k_eff = 0.942394        res = 1.048E-02
[  NORMAL ]  Iteration 51:  k_eff = 0.951566        res = 1.010E-02
[  NORMAL ]  Iteration 52:  k_eff = 0.960490        res = 9.733E-03
[  NORMAL ]  Iteration 53:  k_eff = 0.969168        res = 9.378E-03
[  NORMAL ]  Iteration 54:  k_eff = 0.977604        res = 9.035E-03
[  NORMAL ]  Iteration 55:  k_eff = 0.985800        res = 8.704E-03
[  NORMAL ]  Iteration 56:  k_eff = 0.993761        res = 8.384E-03
[  NORMAL ]  Iteration 57:  k_eff = 1.001491        res = 8.076E-03
[  NORMAL ]  Iteration 58:  k_eff = 1.008992        res = 7.778E-03
[  NORMAL ]  Iteration 59:  k_eff = 1.016271        res = 7.490E-03
[  NORMAL ]  Iteration 60:  k_eff = 1.023330        res = 7.213E-03
[  NORMAL ]  Iteration 61:  k_eff = 1.030174        res = 6.946E-03
[  NORMAL ]  Iteration 62:  k_eff = 1.036809        res = 6.688E-03
[  NORMAL ]  Iteration 63:  k_eff = 1.043238        res = 6.440E-03
[  NORMAL ]  Iteration 64:  k_eff = 1.049466        res = 6.201E-03
[  NORMAL ]  Iteration 65:  k_eff = 1.055498        res = 5.970E-03
[  NORMAL ]  Iteration 66:  k_eff = 1.061339        res = 5.748E-03
[  NORMAL ]  Iteration 67:  k_eff = 1.066993        res = 5.534E-03
[  NORMAL ]  Iteration 68:  k_eff = 1.072465        res = 5.327E-03
[  NORMAL ]  Iteration 69:  k_eff = 1.077760        res = 5.129E-03
[  NORMAL ]  Iteration 70:  k_eff = 1.082882        res = 4.937E-03
[  NORMAL ]  Iteration 71:  k_eff = 1.087837        res = 4.753E-03
[  NORMAL ]  Iteration 72:  k_eff = 1.092628        res = 4.575E-03
[  NORMAL ]  Iteration 73:  k_eff = 1.097260        res = 4.404E-03
[  NORMAL ]  Iteration 74:  k_eff = 1.101737        res = 4.239E-03
[  NORMAL ]  Iteration 75:  k_eff = 1.106065        res = 4.081E-03
[  NORMAL ]  Iteration 76:  k_eff = 1.110247        res = 3.928E-03
[  NORMAL ]  Iteration 77:  k_eff = 1.114288        res = 3.781E-03
[  NORMAL ]  Iteration 78:  k_eff = 1.118191        res = 3.639E-03
[  NORMAL ]  Iteration 79:  k_eff = 1.121961        res = 3.503E-03
[  NORMAL ]  Iteration 80:  k_eff = 1.125603        res = 3.372E-03
[  NORMAL ]  Iteration 81:  k_eff = 1.129119        res = 3.245E-03
[  NORMAL ]  Iteration 82:  k_eff = 1.132513        res = 3.124E-03
[  NORMAL ]  Iteration 83:  k_eff = 1.135790        res = 3.007E-03
[  NORMAL ]  Iteration 84:  k_eff = 1.138954        res = 2.894E-03
[  NORMAL ]  Iteration 85:  k_eff = 1.142007        res = 2.785E-03
[  NORMAL ]  Iteration 86:  k_eff = 1.144953        res = 2.681E-03
[  NORMAL ]  Iteration 87:  k_eff = 1.147796        res = 2.580E-03
[  NORMAL ]  Iteration 88:  k_eff = 1.150539        res = 2.483E-03
[  NORMAL ]  Iteration 89:  k_eff = 1.153185        res = 2.390E-03
[  NORMAL ]  Iteration 90:  k_eff = 1.155738        res = 2.300E-03
[  NORMAL ]  Iteration 91:  k_eff = 1.158200        res = 2.214E-03
[  NORMAL ]  Iteration 92:  k_eff = 1.160575        res = 2.130E-03
[  NORMAL ]  Iteration 93:  k_eff = 1.162865        res = 2.050E-03
[  NORMAL ]  Iteration 94:  k_eff = 1.165073        res = 1.973E-03
[  NORMAL ]  Iteration 95:  k_eff = 1.167202        res = 1.899E-03
[  NORMAL ]  Iteration 96:  k_eff = 1.169255        res = 1.828E-03
[  NORMAL ]  Iteration 97:  k_eff = 1.171234        res = 1.759E-03
[  NORMAL ]  Iteration 98:  k_eff = 1.173142        res = 1.693E-03
[  NORMAL ]  Iteration 99:  k_eff = 1.174980        res = 1.629E-03
[  NORMAL ]  Iteration 100: k_eff = 1.176753        res = 1.567E-03
[  NORMAL ]  Iteration 101: k_eff = 1.178461        res = 1.508E-03
[  NORMAL ]  Iteration 102: k_eff = 1.180107        res = 1.452E-03
[  NORMAL ]  Iteration 103: k_eff = 1.181694        res = 1.397E-03
[  NORMAL ]  Iteration 104: k_eff = 1.183222        res = 1.344E-03
[  NORMAL ]  Iteration 105: k_eff = 1.184695        res = 1.294E-03
[  NORMAL ]  Iteration 106: k_eff = 1.186115        res = 1.245E-03
[  NORMAL ]  Iteration 107: k_eff = 1.187482        res = 1.198E-03
[  NORMAL ]  Iteration 108: k_eff = 1.188799        res = 1.153E-03
[  NORMAL ]  Iteration 109: k_eff = 1.190068        res = 1.109E-03
[  NORMAL ]  Iteration 110: k_eff = 1.191290        res = 1.067E-03
[  NORMAL ]  Iteration 111: k_eff = 1.192468        res = 1.027E-03
[  NORMAL ]  Iteration 112: k_eff = 1.193602        res = 9.883E-04
[  NORMAL ]  Iteration 113: k_eff = 1.194694        res = 9.510E-04
[  NORMAL ]  Iteration 114: k_eff = 1.195746        res = 9.151E-04
[  NORMAL ]  Iteration 115: k_eff = 1.196759        res = 8.805E-04
[  NORMAL ]  Iteration 116: k_eff = 1.197735        res = 8.473E-04
[  NORMAL ]  Iteration 117: k_eff = 1.198674        res = 8.152E-04
[  NORMAL ]  Iteration 118: k_eff = 1.199579        res = 7.844E-04
[  NORMAL ]  Iteration 119: k_eff = 1.200450        res = 7.548E-04
[  NORMAL ]  Iteration 120: k_eff = 1.201289        res = 7.262E-04
[  NORMAL ]  Iteration 121: k_eff = 1.202097        res = 6.988E-04
[  NORMAL ]  Iteration 122: k_eff = 1.202874        res = 6.723E-04
[  NORMAL ]  Iteration 123: k_eff = 1.203623        res = 6.469E-04
[  NORMAL ]  Iteration 124: k_eff = 1.204344        res = 6.224E-04
[  NORMAL ]  Iteration 125: k_eff = 1.205038        res = 5.989E-04
[  NORMAL ]  Iteration 126: k_eff = 1.205706        res = 5.762E-04
[  NORMAL ]  Iteration 127: k_eff = 1.206349        res = 5.544E-04
[  NORMAL ]  Iteration 128: k_eff = 1.206968        res = 5.334E-04
[  NORMAL ]  Iteration 129: k_eff = 1.207564        res = 5.132E-04
[  NORMAL ]  Iteration 130: k_eff = 1.208138        res = 4.938E-04
[  NORMAL ]  Iteration 131: k_eff = 1.208690        res = 4.751E-04
[  NORMAL ]  Iteration 132: k_eff = 1.209221        res = 4.570E-04
[  NORMAL ]  Iteration 133: k_eff = 1.209733        res = 4.397E-04
[  NORMAL ]  Iteration 134: k_eff = 1.210225        res = 4.231E-04
[  NORMAL ]  Iteration 135: k_eff = 1.210699        res = 4.070E-04
[  NORMAL ]  Iteration 136: k_eff = 1.211155        res = 3.916E-04
[  NORMAL ]  Iteration 137: k_eff = 1.211594        res = 3.767E-04
[  NORMAL ]  Iteration 138: k_eff = 1.212017        res = 3.624E-04
[  NORMAL ]  Iteration 139: k_eff = 1.212423        res = 3.487E-04
[  NORMAL ]  Iteration 140: k_eff = 1.212815        res = 3.355E-04
[  NORMAL ]  Iteration 141: k_eff = 1.213191        res = 3.227E-04
[  NORMAL ]  Iteration 142: k_eff = 1.213554        res = 3.105E-04
[  NORMAL ]  Iteration 143: k_eff = 1.213902        res = 2.987E-04
[  NORMAL ]  Iteration 144: k_eff = 1.214238        res = 2.874E-04
[  NORMAL ]  Iteration 145: k_eff = 1.214561        res = 2.764E-04
[  NORMAL ]  Iteration 146: k_eff = 1.214872        res = 2.659E-04
[  NORMAL ]  Iteration 147: k_eff = 1.215171        res = 2.558E-04
[  NORMAL ]  Iteration 148: k_eff = 1.215458        res = 2.461E-04
[  NORMAL ]  Iteration 149: k_eff = 1.215735        res = 2.368E-04
[  NORMAL ]  Iteration 150: k_eff = 1.216002        res = 2.278E-04
[  NORMAL ]  Iteration 151: k_eff = 1.216258        res = 2.191E-04
[  NORMAL ]  Iteration 152: k_eff = 1.216504        res = 2.108E-04
[  NORMAL ]  Iteration 153: k_eff = 1.216742        res = 2.028E-04
[  NORMAL ]  Iteration 154: k_eff = 1.216970        res = 1.951E-04
[  NORMAL ]  Iteration 155: k_eff = 1.217190        res = 1.876E-04
[  NORMAL ]  Iteration 156: k_eff = 1.217401        res = 1.805E-04
[  NORMAL ]  Iteration 157: k_eff = 1.217604        res = 1.736E-04
[  NORMAL ]  Iteration 158: k_eff = 1.217800        res = 1.670E-04
[  NORMAL ]  Iteration 159: k_eff = 1.217988        res = 1.607E-04
[  NORMAL ]  Iteration 160: k_eff = 1.218169        res = 1.546E-04
[  NORMAL ]  Iteration 161: k_eff = 1.218344        res = 1.487E-04
[  NORMAL ]  Iteration 162: k_eff = 1.218511        res = 1.430E-04
[  NORMAL ]  Iteration 163: k_eff = 1.218673        res = 1.376E-04
[  NORMAL ]  Iteration 164: k_eff = 1.218828        res = 1.324E-04
[  NORMAL ]  Iteration 165: k_eff = 1.218977        res = 1.273E-04
[  NORMAL ]  Iteration 166: k_eff = 1.219121        res = 1.225E-04
[  NORMAL ]  Iteration 167: k_eff = 1.219259        res = 1.178E-04
[  NORMAL ]  Iteration 168: k_eff = 1.219392        res = 1.133E-04
[  NORMAL ]  Iteration 169: k_eff = 1.219520        res = 1.090E-04
[  NORMAL ]  Iteration 170: k_eff = 1.219643        res = 1.049E-04
[  NORMAL ]  Iteration 171: k_eff = 1.219761        res = 1.009E-04
[  NORMAL ]  Iteration 172: k_eff = 1.219875        res = 9.702E-05
[  NORMAL ]  Iteration 173: k_eff = 1.219984        res = 9.332E-05
[  NORMAL ]  Iteration 174: k_eff = 1.220090        res = 8.976E-05
[  NORMAL ]  Iteration 175: k_eff = 1.220191        res = 8.634E-05
[  NORMAL ]  Iteration 176: k_eff = 1.220288        res = 8.305E-05
[  NORMAL ]  Iteration 177: k_eff = 1.220382        res = 7.989E-05
[  NORMAL ]  Iteration 178: k_eff = 1.220472        res = 7.684E-05
[  NORMAL ]  Iteration 179: k_eff = 1.220559        res = 7.392E-05
[  NORMAL ]  Iteration 180: k_eff = 1.220643        res = 7.110E-05
[  NORMAL ]  Iteration 181: k_eff = 1.220723        res = 6.839E-05
[  NORMAL ]  Iteration 182: k_eff = 1.220800        res = 6.578E-05
[  NORMAL ]  Iteration 183: k_eff = 1.220874        res = 6.327E-05
[  NORMAL ]  Iteration 184: k_eff = 1.220946        res = 6.086E-05
[  NORMAL ]  Iteration 185: k_eff = 1.221015        res = 5.854E-05
[  NORMAL ]  Iteration 186: k_eff = 1.221081        res = 5.631E-05
[  NORMAL ]  Iteration 187: k_eff = 1.221144        res = 5.416E-05
[  NORMAL ]  Iteration 188: k_eff = 1.221206        res = 5.209E-05
[  NORMAL ]  Iteration 189: k_eff = 1.221264        res = 5.011E-05
[  NORMAL ]  Iteration 190: k_eff = 1.221321        res = 4.820E-05
[  NORMAL ]  Iteration 191: k_eff = 1.221375        res = 4.636E-05
[  NORMAL ]  Iteration 192: k_eff = 1.221428        res = 4.459E-05
[  NORMAL ]  Iteration 193: k_eff = 1.221478        res = 4.289E-05
[  NORMAL ]  Iteration 194: k_eff = 1.221527        res = 4.125E-05
[  NORMAL ]  Iteration 195: k_eff = 1.221573        res = 3.968E-05
[  NORMAL ]  Iteration 196: k_eff = 1.221618        res = 3.816E-05
[  NORMAL ]  Iteration 197: k_eff = 1.221661        res = 3.671E-05
[  NORMAL ]  Iteration 198: k_eff = 1.221703        res = 3.531E-05
[  NORMAL ]  Iteration 199: k_eff = 1.221743        res = 3.396E-05
[  NORMAL ]  Iteration 200: k_eff = 1.221781        res = 3.266E-05
[  NORMAL ]  Iteration 201: k_eff = 1.221818        res = 3.142E-05
[  NORMAL ]  Iteration 202: k_eff = 1.221853        res = 3.022E-05
[  NORMAL ]  Iteration 203: k_eff = 1.221888        res = 2.906E-05
[  NORMAL ]  Iteration 204: k_eff = 1.221920        res = 2.795E-05
[  NORMAL ]  Iteration 205: k_eff = 1.221952        res = 2.689E-05
[  NORMAL ]  Iteration 206: k_eff = 1.221982        res = 2.586E-05
[  NORMAL ]  Iteration 207: k_eff = 1.222012        res = 2.487E-05
[  NORMAL ]  Iteration 208: k_eff = 1.222040        res = 2.392E-05
[  NORMAL ]  Iteration 209: k_eff = 1.222067        res = 2.301E-05
[  NORMAL ]  Iteration 210: k_eff = 1.222093        res = 2.213E-05
[  NORMAL ]  Iteration 211: k_eff = 1.222118        res = 2.129E-05
[  NORMAL ]  Iteration 212: k_eff = 1.222142        res = 2.047E-05
[  NORMAL ]  Iteration 213: k_eff = 1.222165        res = 1.969E-05
[  NORMAL ]  Iteration 214: k_eff = 1.222187        res = 1.894E-05
[  NORMAL ]  Iteration 215: k_eff = 1.222209        res = 1.822E-05
[  NORMAL ]  Iteration 216: k_eff = 1.222229        res = 1.752E-05
[  NORMAL ]  Iteration 217: k_eff = 1.222249        res = 1.685E-05
[  NORMAL ]  Iteration 218: k_eff = 1.222268        res = 1.621E-05
[  NORMAL ]  Iteration 219: k_eff = 1.222287        res = 1.559E-05
[  NORMAL ]  Iteration 220: k_eff = 1.222304        res = 1.499E-05
[  NORMAL ]  Iteration 221: k_eff = 1.222321        res = 1.442E-05
[  NORMAL ]  Iteration 222: k_eff = 1.222337        res = 1.387E-05
[  NORMAL ]  Iteration 223: k_eff = 1.222353        res = 1.334E-05
[  NORMAL ]  Iteration 224: k_eff = 1.222368        res = 1.283E-05
[  NORMAL ]  Iteration 225: k_eff = 1.222383        res = 1.234E-05
[  NORMAL ]  Iteration 226: k_eff = 1.222397        res = 1.187E-05
[  NORMAL ]  Iteration 227: k_eff = 1.222410        res = 1.142E-05
[  NORMAL ]  Iteration 228: k_eff = 1.222423        res = 1.098E-05
[  NORMAL ]  Iteration 229: k_eff = 1.222435        res = 1.056E-05
[  NORMAL ]  Iteration 230: k_eff = 1.222447        res = 1.016E-05
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Print report of keff and bias with OpenMC</span>
<span class="n">openmoc_keff</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">getKeff</span><span class="p">()</span>
<span class="n">openmc_keff</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">k_combined</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bias</span> <span class="o">=</span> <span class="p">(</span><span class="n">openmoc_keff</span> <span class="o">-</span> <span class="n">openmc_keff</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e5</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;openmc keff = {0:1.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">openmc_keff</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;openmoc keff = {0:1.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">openmoc_keff</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;bias [pcm]: {0:1.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bias</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>openmc keff = 1.223729
openmoc keff = 1.222447
bias [pcm]: -128.2
</pre></div>
</div>
<p>There is a non-trivial bias in both the 2-group and 8-group cases. In
the case of a pin cell, one can show that these biases do not converge
to &lt;100 pcm with more particle histories. For heterogeneous geometries,
additional measures must be taken to address the following three sources
of bias:</p>
<ul class="simple">
<li>Appropriate transport-corrected cross sections</li>
<li>Spatial discretization of OpenMOC&#8217;s mesh</li>
<li>Constant-in-angle multi-group cross sections</li>
</ul>
</div>
<div class="section" id="visualizing-mgxs-data">
<h1>Visualizing MGXS Data<a class="headerlink" href="#visualizing-mgxs-data" title="Permalink to this headline">¶</a></h1>
<p>It is often insightful to generate visual depictions of multi-group
cross sections. There are many different types of plots which may be
useful for multi-group cross section visualization, only a few of which
will be shown here for enrichment and inspiration.</p>
<p>One particularly useful visualization is a comparison of the
continuous-energy and multi-group cross sections for a particular
nuclide and reaction type. We illustrate one option for generating such
plots with the use of the open source <a class="reference external" href="http://pyne.io/">PyNE</a> library
to parse continuous-energy cross sections from the cross section data
library provided with OpenMC. First, we instantiate a
<code class="docutils literal"><span class="pre">pyne.ace.Library</span></code> object for U-235 as follows.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a PyNE ACE continuous-energy cross sections library</span>
<span class="n">pyne_lib</span> <span class="o">=</span> <span class="n">pyne</span><span class="o">.</span><span class="n">ace</span><span class="o">.</span><span class="n">Library</span><span class="p">(</span><span class="s">&#39;../../../../data/nndc/293.6K/U_235_293.6K.ace&#39;</span><span class="p">)</span>
<span class="n">pyne_lib</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;92235.71c&#39;</span><span class="p">)</span>

<span class="c"># Extract the U-235 data from the library</span>
<span class="n">u235</span> <span class="o">=</span> <span class="n">pyne_lib</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s">&#39;92235.71c&#39;</span><span class="p">]</span>

<span class="c"># Extract the continuous-energy U-235 fission cross section data</span>
<span class="n">fission</span> <span class="o">=</span> <span class="n">u235</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
<p>Now, we use <code class="docutils literal"><span class="pre">`matplotlib</span></code> &lt;<a class="reference external" href="http://matplotlib.org/">http://matplotlib.org/</a>&gt;`__ and
<code class="docutils literal"><span class="pre">`seaborn</span></code> &lt;<a class="reference external" href="http://stanford.edu/~mwaskom/software/seaborn/">http://stanford.edu/~mwaskom/software/seaborn/</a>&gt;`__ to plot
the continuous-energy and multi-group cross sections on a single plot.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a loglog plot of the U-235 continuous-energy fission cross section</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">u235</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">fission</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Extract energy group bounds and MGXS values to plot</span>
<span class="n">nufission</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">fuel_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;fission&#39;</span><span class="p">]</span>
<span class="n">energy_groups</span> <span class="o">=</span> <span class="n">nufission</span><span class="o">.</span><span class="n">energy_groups</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">energy_groups</span><span class="o">.</span><span class="n">group_edges</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nufission</span><span class="o">.</span><span class="n">get_xs</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;U-235&#39;</span><span class="p">],</span> <span class="n">order_groups</span><span class="o">=</span><span class="s">&#39;decreasing&#39;</span><span class="p">,</span> <span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;micro&#39;</span><span class="p">)</span>

<span class="c"># Fix low energy bound to the value defined by the ACE library</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u235</span><span class="o">.</span><span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># Extend the mgxs values array for matplotlib&#39;s step plot</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c"># Create a step plot for the MGXS</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;U-235 Fission Cross Section&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Energy [MeV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Micro Fission XS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;Continuous&#39;</span><span class="p">,</span> <span class="s">&#39;Multi-Group&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mf">9.9999999999999994e-12</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/mgxs-part-ii-content_67_1.png" src="../../_images/mgxs-part-ii-content_67_1.png" />
<p>Another useful type of illustration is scattering matrix sparsity
structures. First, we extract Pandas <code class="docutils literal"><span class="pre">DataFrames</span></code> for the H-1 and O-16
scattering matrices.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Construct a Pandas DataFrame for the microscopic nu-scattering matrix</span>
<span class="n">nuscatter</span> <span class="o">=</span> <span class="n">xs_library</span><span class="p">[</span><span class="n">moderator_cell</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="s">&#39;nu-scatter&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">nuscatter</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">xs_type</span><span class="o">=</span><span class="s">&#39;micro&#39;</span><span class="p">)</span>

<span class="c"># Slice DataFrame in two for each nuclide&#39;s mean values</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;nuclide&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;H-1&#39;</span><span class="p">][</span><span class="s">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">o16</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;nuclide&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;O-16&#39;</span><span class="p">][</span><span class="s">&#39;mean&#39;</span><span class="p">]</span>

<span class="c"># Cast DataFrames as NumPy arrays</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
<span class="n">o16</span> <span class="o">=</span> <span class="n">o16</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>

<span class="c"># Reshape arrays to 2D matrix for plotting</span>
<span class="n">h1</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">fine_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">,</span> <span class="n">fine_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">)</span>
<span class="n">o16</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">fine_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">,</span> <span class="n">fine_groups</span><span class="o">.</span><span class="n">num_groups</span><span class="p">)</span>
</pre></div>
</div>
<p>Matplotlib&#8217;s <code class="docutils literal"><span class="pre">imshow</span></code> routine can be used to plot the matrices to
illustrate their sparsity structures.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create plot of the H-1 scattering matrix</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;H-1 Scattering Matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Group Out&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Group In&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="c"># Create plot of the O-16 scattering matrix</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;O-16 Scattering Matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Group Out&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Group In&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="c"># Show the plot on screen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/mgxs-part-ii-content_71_0.png" src="../../_images/mgxs-part-ii-content_71_0.png" />
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2015, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>