<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generate Input Files &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMC Documentation" href="../../index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner">
        <a href="../../index.html">
          <img class="logo" src="../../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <p>This notebook demonstrates some basic post-processing tasks that can be
performed with the Python API, such as plotting a 2D mesh tally and
plotting neutron source sites from an eigenvalue calculation. The
problem we will use is a simple reflected pin-cell.</p>
<div class="code python highlight-python"><div class="highlight"><pre>from IPython.display import Image
import numpy as np
import matplotlib.pyplot as plt

import openmc
from openmc.statepoint import StatePoint

%matplotlib inline
</pre></div>
</div>
<div class="section" id="generate-input-files">
<h1>Generate Input Files<a class="headerlink" href="#generate-input-files" title="Permalink to this headline">¶</a></h1>
<p>First we need to define materials that will be used in the problem.
Before defining a material, we must create nuclides that are used in the
material.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate some Nuclides</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;H-1&#39;</span><span class="p">)</span>
<span class="n">b10</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;B-10&#39;</span><span class="p">)</span>
<span class="n">o16</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;O-16&#39;</span><span class="p">)</span>
<span class="n">u235</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-235&#39;</span><span class="p">)</span>
<span class="n">u238</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-238&#39;</span><span class="p">)</span>
<span class="n">zr90</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;Zr-90&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the nuclides we defined, we will now create three materials for the
fuel, water, and cladding of the fuel pin.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># 1.6 enriched fuel</span>
<span class="n">fuel</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">10.31341</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u235</span><span class="p">,</span> <span class="mf">3.7503e-4</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u238</span><span class="p">,</span> <span class="mf">2.2625e-2</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">4.6007e-2</span><span class="p">)</span>

<span class="c"># borated water</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Borated Water&#39;</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">0.740582</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mf">4.9457e-2</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">2.4732e-2</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">b10</span><span class="p">,</span> <span class="mf">8.0042e-6</span><span class="p">)</span>

<span class="c"># zircaloy</span>
<span class="n">zircaloy</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Zircaloy&#39;</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">6.55</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">zr90</span><span class="p">,</span> <span class="mf">7.2758e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>With our three materials, we can now create a materials file object that
can be exported to an actual XML file.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a MaterialsFile, add Materials</span>
<span class="n">materials_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">MaterialsFile</span><span class="p">()</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">zircaloy</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">default_xs</span> <span class="o">=</span> <span class="s">&#39;71c&#39;</span>

<span class="c"># Export to &quot;materials.xml&quot;</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s move on to the geometry. Our problem will have three regions
for the fuel, the clad, and the surrounding coolant. The first step is
to create the bounding surfaces &#8211; in this case two cylinders and six
reflective planes.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create cylinders for the fuel and clad</span>
<span class="n">fuel_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.39218</span><span class="p">)</span>
<span class="n">clad_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.45720</span><span class="p">)</span>

<span class="c"># Create boundary planes to surround the geometry</span>
<span class="c"># Use both reflective and vacuum boundaries to make life interesting</span>
<span class="n">min_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">min_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">min_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=-</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=+</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the surfaces defined, we can now create cells that are defined by
intersections of half-spaces created by the surfaces.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a Universe to encapsulate a fuel pin</span>
<span class="n">pin_cell_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel Pin&#39;</span><span class="p">)</span>

<span class="c"># Create fuel Cell</span>
<span class="n">fuel_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">fuel</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">-</span><span class="n">fuel_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">fuel_cell</span><span class="p">)</span>

<span class="c"># Create a clad Cell</span>
<span class="n">clad_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Clad&#39;</span><span class="p">)</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">zircaloy</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">fuel_outer_radius</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">clad_cell</span><span class="p">)</span>

<span class="c"># Create a moderator Cell</span>
<span class="n">moderator_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Moderator&#39;</span><span class="p">)</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">water</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">moderator_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>OpenMC requires that there is a &#8220;root&#8221; universe. Let us create a root
cell that is filled by the pin cell universe and then assign it to the
root universe.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create root Cell</span>
<span class="n">root_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;root cell&#39;</span><span class="p">)</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">pin_cell_universe</span>

<span class="c"># Add boundary planes</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">min_x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_x</span> <span class="o">&amp;</span> <span class="o">+</span><span class="n">min_y</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_y</span> <span class="o">&amp;</span> <span class="o">+</span><span class="n">min_z</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_z</span>

<span class="c"># Create root Universe</span>
<span class="n">root_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">universe_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;root universe&#39;</span><span class="p">)</span>
<span class="n">root_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">root_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>We now must create a geometry that is assigned a root universe, put the
geometry into a geometry file, and export it to XML.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create Geometry and set root Universe</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Geometry</span><span class="p">()</span>
<span class="n">geometry</span><span class="o">.</span><span class="n">root_universe</span> <span class="o">=</span> <span class="n">root_universe</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a GeometryFile</span>
<span class="n">geometry_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">GeometryFile</span><span class="p">()</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>

<span class="c"># Export to &quot;geometry.xml&quot;</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>With the geometry and materials finished, we now just need to define
simulation parameters. In this case, we will use 10 inactive batches and
90 active batches each with 5000 particles.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># OpenMC simulation parameters</span>
<span class="n">batches</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">inactive</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">particles</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="c"># Instantiate a SettingsFile</span>
<span class="n">settings_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">SettingsFile</span><span class="p">()</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">batches</span> <span class="o">=</span> <span class="n">batches</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">inactive</span> <span class="o">=</span> <span class="n">inactive</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="n">particles</span>
<span class="n">source_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">]</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">set_source_space</span><span class="p">(</span><span class="s">&#39;box&#39;</span><span class="p">,</span> <span class="n">source_bounds</span><span class="p">)</span>

<span class="c"># Export to &quot;settings.xml&quot;</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Let us also create a plot file that we can use to verify that our pin
cell geometry was created successfully.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a Plot</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">plot_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;materials-xy&#39;</span>
<span class="n">plot</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.26</span><span class="p">,</span> <span class="mf">1.26</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#39;mat&#39;</span>

<span class="c"># Instantiate a PlotsFile, add Plot, and export to &quot;plots.xml&quot;</span>
<span class="n">plot_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">PlotsFile</span><span class="p">()</span>
<span class="n">plot_file</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">plot_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>With the plots.xml file, we can now generate and view the plot. OpenMC
outputs plots in .ppm format, which can be converted into a compressed
format like .png with the convert utility.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Run openmc in plotting mode</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Executor</span><span class="p">()</span>
<span class="n">executor</span><span class="o">.</span><span class="n">plot_geometry</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># Convert OpenMC&#39;s funky ppm to png
!convert materials-xy.ppm materials-xy.png

# Display the materials plot inline
Image(filename=&#39;materials-xy.png&#39;)
</pre></div>
</div>
<img alt="../../_images/post-processing-content_24_0.png" src="../../_images/post-processing-content_24_0.png" />
<p>As we can see from the plot, we have a nice pin cell with fuel,
cladding, and water! Before we run our simulation, we need to tell the
code what we want to tally. The following code shows how to create a 2D
mesh tally.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate an empty TalliesFile</span>
<span class="n">tallies_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">TalliesFile</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create mesh which will be used for tally</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">lower_left</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63</span><span class="p">]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">upper_right</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">]</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="c"># Create mesh filter for tally</span>
<span class="n">mesh_filter</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;mesh&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mesh_filter</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>

<span class="c"># Create mesh tally to score flux and fission rate</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;flux&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">mesh_filter</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;flux&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;fission&#39;</span><span class="p">)</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_tally</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Export to &quot;tallies.xml&quot;</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we a have a complete set of inputs, so we can go ahead and run our
simulation.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Run OpenMC!</span>
<span class="n">executor</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>       .d88888b.                             888b     d888  .d8888b.
      d88P&quot; &quot;Y88b                            8888b   d8888 d88P  Y88b
      888     888                            88888b.d88888 888    888
      888     888 88888b.   .d88b.  88888b.  888Y88888P888 888
      888     888 888 &quot;88b d8P  Y8b 888 &quot;88b 888 Y888P 888 888
      888     888 888  888 88888888 888  888 888  Y8P  888 888    888
      Y88b. .d88P 888 d88P Y8b.     888  888 888   &quot;   888 Y88b  d88P
       &quot;Y88888P&quot;  88888P&quot;   &quot;Y8888  888  888 888       888  &quot;Y8888P&quot;
__________________888______________________________________________________
                  888
                  888

      Copyright:      2011-2015 Massachusetts Institute of Technology
      License:        http://mit-crpg.github.io/openmc/license.html
      Version:        0.7.0
      Git SHA1:       c4b14a5ef87f004528d35cbf33fef3ed15a386ca
      Date/Time:      2015-11-29 16:46:53
      MPI Processes:  1

 ===========================================================================
 ========================&gt;     INITIALIZATION     &lt;=========================
 ===========================================================================

 Reading settings XML file...
 Reading cross sections XML file...
 Reading geometry XML file...
 Reading materials XML file...
 Reading tallies XML file...
 Building neighboring cells lists for each surface...
 Loading ACE cross section table: 92235.71c
 Loading ACE cross section table: 92238.71c
 Loading ACE cross section table: 8016.71c
 Loading ACE cross section table: 1001.71c
 Loading ACE cross section table: 5010.71c
 Loading ACE cross section table: 40090.71c
 Maximum neutron transport energy: 20.0000 MeV for 92235.71c
 Initializing source particles...

 ===========================================================================
 ====================&gt;     K EIGENVALUE SIMULATION     &lt;====================
 ===========================================================================

  Bat./Gen.      k            Average k
  =========   ========   ====================
        1/1    1.04894
        2/1    1.01711
        3/1    1.05357
        4/1    1.03052
        5/1    1.06523
        6/1    1.06806
        7/1    1.05161
        8/1    1.04199
        9/1    1.05010
       10/1    1.04617
       11/1    1.04894
       12/1    1.06806    1.05850 +/- 0.00956
       13/1    1.05002    1.05567 +/- 0.00620
       14/1    1.03471    1.05043 +/- 0.00683
       15/1    1.01803    1.04395 +/- 0.00837
       16/1    1.05588    1.04594 +/- 0.00712
       17/1    1.07503    1.05010 +/- 0.00731
       18/1    1.02786    1.04732 +/- 0.00691
       19/1    1.00071    1.04214 +/- 0.00800
       20/1    1.05587    1.04351 +/- 0.00729
       21/1    1.03886    1.04309 +/- 0.00660
       22/1    1.04335    1.04311 +/- 0.00603
       23/1    1.04057    1.04292 +/- 0.00555
       24/1    1.01976    1.04126 +/- 0.00540
       25/1    1.05811    1.04238 +/- 0.00515
       26/1    1.02351    1.04120 +/- 0.00496
       27/1    1.05261    1.04188 +/- 0.00471
       28/1    1.03355    1.04141 +/- 0.00446
       29/1    1.02797    1.04071 +/- 0.00428
       30/1    1.03758    1.04055 +/- 0.00406
       31/1    1.04883    1.04094 +/- 0.00388
       32/1    1.03557    1.04070 +/- 0.00371
       33/1    1.02947    1.04021 +/- 0.00358
       34/1    1.03651    1.04006 +/- 0.00343
       35/1    1.03331    1.03979 +/- 0.00330
       36/1    1.05947    1.04054 +/- 0.00326
       37/1    1.05093    1.04093 +/- 0.00316
       38/1    1.06787    1.04189 +/- 0.00319
       39/1    1.01451    1.04095 +/- 0.00322
       40/1    1.02351    1.04037 +/- 0.00317
       41/1    1.04826    1.04062 +/- 0.00307
       42/1    1.04228    1.04067 +/- 0.00298
       43/1    1.03214    1.04041 +/- 0.00290
       44/1    1.04950    1.04068 +/- 0.00282
       45/1    1.06616    1.04141 +/- 0.00284
       46/1    1.07039    1.04221 +/- 0.00287
       47/1    1.00292    1.04115 +/- 0.00299
       48/1    1.04477    1.04125 +/- 0.00291
       49/1    1.03360    1.04105 +/- 0.00284
       50/1    1.04783    1.04122 +/- 0.00277
       51/1    1.03985    1.04119 +/- 0.00271
       52/1    1.02507    1.04080 +/- 0.00267
       53/1    1.03477    1.04066 +/- 0.00261
       54/1    1.00412    1.03983 +/- 0.00268
       55/1    1.02239    1.03945 +/- 0.00265
       56/1    1.04308    1.03952 +/- 0.00259
       57/1    1.05534    1.03986 +/- 0.00256
       58/1    1.06667    1.04042 +/- 0.00257
       59/1    1.06458    1.04091 +/- 0.00256
       60/1    1.00304    1.04015 +/- 0.00262
       61/1    1.05038    1.04036 +/- 0.00258
       62/1    1.02904    1.04014 +/- 0.00254
       63/1    1.00249    1.03943 +/- 0.00259
       64/1    1.01779    1.03903 +/- 0.00257
       65/1    1.05335    1.03929 +/- 0.00254
       66/1    1.06231    1.03970 +/- 0.00253
       67/1    1.02382    1.03942 +/- 0.00250
       68/1    1.03796    1.03939 +/- 0.00245
       69/1    1.03672    1.03935 +/- 0.00241
       70/1    1.02926    1.03918 +/- 0.00238
       71/1    1.05834    1.03950 +/- 0.00236
       72/1    1.04332    1.03956 +/- 0.00232
       73/1    1.05613    1.03982 +/- 0.00230
       74/1    1.01963    1.03950 +/- 0.00228
       75/1    1.02228    1.03924 +/- 0.00226
       76/1    1.04842    1.03938 +/- 0.00223
       77/1    1.02157    1.03911 +/- 0.00222
       78/1    1.02810    1.03895 +/- 0.00219
       79/1    1.05030    1.03912 +/- 0.00216
       80/1    1.02391    1.03890 +/- 0.00214
       81/1    1.02488    1.03870 +/- 0.00212
       82/1    1.04957    1.03885 +/- 0.00210
       83/1    1.03499    1.03880 +/- 0.00207
       84/1    1.05922    1.03907 +/- 0.00206
       85/1    1.05898    1.03934 +/- 0.00205
       86/1    1.02242    1.03912 +/- 0.00204
       87/1    1.03278    1.03904 +/- 0.00201
       88/1    1.06134    1.03932 +/- 0.00201
       89/1    1.04521    1.03940 +/- 0.00198
       90/1    1.04277    1.03944 +/- 0.00196
       91/1    1.04214    1.03947 +/- 0.00193
       92/1    1.05610    1.03967 +/- 0.00192
       93/1    1.04531    1.03974 +/- 0.00190
       94/1    1.01534    1.03945 +/- 0.00190
       95/1    1.03971    1.03945 +/- 0.00187
       96/1    1.07183    1.03983 +/- 0.00189
       97/1    1.07214    1.04020 +/- 0.00191
       98/1    1.03710    1.04017 +/- 0.00188
       99/1    1.02532    1.04000 +/- 0.00187
      100/1    1.03965    1.04000 +/- 0.00185
 Creating state point statepoint.100.h5...

 ===========================================================================
 ======================&gt;     SIMULATION FINISHED     &lt;======================
 ===========================================================================


 =======================&gt;     TIMING STATISTICS     &lt;=======================

 Total time for initialization     =  3.7900E-01 seconds
   Reading cross sections          =  8.7000E-02 seconds
 Total time in simulation          =  2.2064E+02 seconds
   Time in transport only          =  2.2060E+02 seconds
   Time in inactive batches        =  8.7100E+00 seconds
   Time in active batches          =  2.1193E+02 seconds
   Time synchronizing fission bank =  1.4000E-02 seconds
     Sampling source sites         =  8.0000E-03 seconds
     SEND/RECV source sites        =  2.0000E-03 seconds
   Time accumulating tallies       =  1.3000E-02 seconds
 Total time for finalization       =  1.6600E-01 seconds
 Total time elapsed                =  2.2120E+02 seconds
 Calculation Rate (inactive)       =  5740.53 neutrons/second
 Calculation Rate (active)         =  2123.37 neutrons/second

 ============================&gt;     RESULTS     &lt;============================

 k-effective (Collision)     =  1.03912 +/-  0.00160
 k-effective (Track-length)  =  1.04000 +/-  0.00185
 k-effective (Absorption)    =  1.04240 +/-  0.00156
 Combined k-effective        =  1.04078 +/-  0.00127
 Leakage Fraction            =  0.00000 +/-  0.00000
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="tally-data-processing">
<h1>Tally Data Processing<a class="headerlink" href="#tally-data-processing" title="Permalink to this headline">¶</a></h1>
<p>Our simulation ran successfully and created a statepoint file with all
the tally data in it. We begin our analysis here loading the statepoint
file and &#8216;reading&#8217; the results. By default, data from the statepoint
file is only read into memory when it is requested. This helps keep the
memory use to a minimum even when a statepoint file may be huge.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Load the statepoint file</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">StatePoint</span><span class="p">(</span><span class="s">&#39;statepoint.100.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next we need to get the tally, which can be done with the
<code class="docutils literal"><span class="pre">StatePoint.get_tally(...)</span></code> method.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">tally</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_tally</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;flux&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Tally
    ID             =        10000
    Name           =
    Filters        =
                            mesh    [10000]
    Nuclides       =        total
    Scores         =        [u&#39;flux&#39;, u&#39;fission&#39;]
    Estimator      =        tracklength
</pre></div>
</div>
<p>The statepoint file actually stores the sum and sum-of-squares for each
tally bin from which the mean and variance can be calculated as
described
<a class="reference external" href="http://mit-crpg.github.io/openmc/methods/tallies.html#variance">here</a>.
The sum and sum-of-squares can be accessed using the <code class="docutils literal"><span class="pre">sum</span></code> and
<code class="docutils literal"><span class="pre">sum_sq</span></code> properties:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">tally</span><span class="o">.</span><span class="n">sum</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[[</span> <span class="mf">0.4107676</span> <span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.40849402</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.41014343</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

       <span class="o">...</span><span class="p">,</span>
       <span class="p">[[</span> <span class="mf">0.41049467</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.40982242</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.40996987</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]]])</span>
</pre></div>
</div>
<p>However, the mean and standard deviation of the mean are usually what
you are more interested in. The Tally class also has properties <code class="docutils literal"><span class="pre">mean</span></code>
and <code class="docutils literal"><span class="pre">std_dev</span></code> which automatically calculate these statistics
on-the-fly.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">tally</span><span class="o">.</span><span class="n">std_dev</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">array</span><span class="p">([[[</span> <span class="mf">0.00456408</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

        <span class="p">[[</span> <span class="mf">0.00453882</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

        <span class="p">[[</span> <span class="mf">0.00455715</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

        <span class="o">...</span><span class="p">,</span>
        <span class="p">[[</span> <span class="mf">0.00456105</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

        <span class="p">[[</span> <span class="mf">0.00455358</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]],</span>

        <span class="p">[[</span> <span class="mf">0.00455522</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]]]),</span>
 <span class="n">array</span><span class="p">([[[</span>  <span class="mf">1.95085625e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]],</span>

        <span class="p">[[</span>  <span class="mf">1.78129859e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]],</span>

        <span class="p">[[</span>  <span class="mf">1.89709648e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]],</span>

        <span class="o">...</span><span class="p">,</span>
        <span class="p">[[</span>  <span class="mf">1.56286612e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]],</span>

        <span class="p">[[</span>  <span class="mf">1.65813279e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]],</span>

        <span class="p">[[</span>  <span class="mf">1.67530331e-05</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">]]]))</span>
</pre></div>
</div>
<p>The tally data has three dimensions: one for filter combinations, one
for nuclides, and one for scores. We see that there are 10000 filter
combinations (corresponding to the 100 x 100 mesh bins), a single
nuclide (since none was specified), and two scores. If we only want to
look at a single score, we can use the <code class="docutils literal"><span class="pre">get_slice(...)</span></code> method as
follows.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">flux</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;flux&#39;</span><span class="p">])</span>
<span class="n">fission</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fission&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Tally
    ID             =        10000
    Name           =
    Filters        =
                            mesh    [10000]
    Nuclides       =        total
    Scores         =        [u&#39;flux&#39;]
    Estimator      =        tracklength
</pre></div>
</div>
<p>To get the bins into a form that we can plot, we can simply change the
shape of the array since it is a numpy array.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">flux</span><span class="o">.</span><span class="n">std_dev</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fission</span><span class="o">.</span><span class="n">std_dev</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fission</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">fig2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fission</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x7fe38b3027d0&gt;
</pre></div>
</div>
<img alt="../../_images/post-processing-content_44_1.png" src="../../_images/post-processing-content_44_1.png" />
<p>Now let&#8217;s say we want to look at the distribution of relative errors of
our tally bins for flux. First we create a new variable called
<code class="docutils literal"><span class="pre">relative_error</span></code> and set it to the ratio of the standard deviation and
the mean, being careful not to divide by zero in case some bins were
never scored to.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Determine relative error</span>
<span class="n">relative_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">std_dev</span><span class="p">)</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">mean</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">relative_error</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">std_dev</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">/</span> <span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="c"># distribution of relative errors</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">relative_error</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/post-processing-content_46_0.png" src="../../_images/post-processing-content_46_0.png" />
</div>
<div class="section" id="source-sites">
<h1>Source Sites<a class="headerlink" href="#source-sites" title="Permalink to this headline">¶</a></h1>
<p>Source sites can be accessed from the <code class="docutils literal"><span class="pre">source</span></code> property. As shown
below, the source sites are represented as a numpy array with a
structured datatype.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sp</span><span class="o">.</span><span class="n">source</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.2712169917165897</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04844236597355761</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1887902218343974</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3889598463000694</span><span class="p">,</span> <span class="mf">0.8470657529949065</span><span class="p">,</span> <span class="mf">0.36220139158953857</span><span class="p">],</span> <span class="mf">2.2746035619924734</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.080729018085932</span><span class="p">,</span> <span class="mf">0.19838688738571317</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.38053428394017363</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.6604834049157511</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6893239101986768</span><span class="p">,</span> <span class="mf">0.2976478097673534</span><span class="p">],</span> <span class="mf">0.7833467555325838</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.019430574216787868</span><span class="p">,</span> <span class="mf">0.06594180627832635</span><span class="p">,</span> <span class="mf">0.23329810254580194</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.7472138923667574</span><span class="p">,</span> <span class="mf">0.13227244377548197</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.651287493870243</span><span class="p">],</span> <span class="mf">1.1632342240714935</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.18544614514351207</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0113070561851496</span><span class="p">,</span> <span class="mf">0.5468392238881264</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.8006491411918817</span><span class="p">,</span> <span class="mf">0.43855795172388223</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4082007786475368</span><span class="p">],</span> <span class="mf">1.4358240241589555</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.18544614514351207</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0113070561851496</span><span class="p">,</span> <span class="mf">0.5468392238881264</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5150076397044656</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.34922134026850293</span><span class="p">,</span> <span class="mf">0.7828228321575105</span><span class="p">],</span> <span class="mf">1.5771133724329802</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.2722999793764598</span><span class="p">,</span> <span class="mf">0.22680062445008103</span><span class="p">,</span> <span class="mf">0.2987060438567475</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.9207818175032396</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2884020326181676</span><span class="p">,</span> <span class="mf">0.26265017063984586</span><span class="p">],</span> <span class="mf">2.932342523379745</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;wgt&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;xyz&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s">&#39;uvw&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;delayed_group&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;i4&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>If we want, say, only the energies from the source sites, we can simply
index the source array with the name of the field:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="mf">2.27460356</span><span class="p">,</span>  <span class="mf">0.78334676</span><span class="p">,</span>  <span class="mf">1.16323422</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">1.43582402</span><span class="p">,</span>
        <span class="mf">1.57711337</span><span class="p">,</span>  <span class="mf">2.93234252</span><span class="p">])</span>
</pre></div>
</div>
<p>Now, we can look at things like the energy distribution of source sites.
Note that we don&#8217;t directly use the <code class="docutils literal"><span class="pre">matplotlib.pyplot.hist</span></code> method
since our binning is logarithmic.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create log-spaced energy bins from 1 keV to 100 MeV</span>
<span class="n">energy_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calculate pdf for source energies</span>
<span class="n">probability</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">],</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Make sure integrating the PDF gives us unity</span>
<span class="k">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">probability</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">)))</span>

<span class="c"># Plot source energy PDF</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">probability</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Energy (MeV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Probability/MeV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">1.0</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x7fe3652fd810&gt;
</pre></div>
</div>
<img alt="../../_images/post-processing-content_53_2.png" src="../../_images/post-processing-content_53_2.png" />
<p>Let&#8217;s also look at the spatial distribution of the sites. To make the
plot a little more interesting, we can also include the direction of the
particle emitted from the source and color each source by the logarithm
of its energy.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;xyz&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;xyz&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;uvw&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;uvw&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/usr/lib/pymodules/python2.7/matplotlib/collections.py:548: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  if self._edgecolors == &#39;face&#39;:
</pre></div>
</div>
<img alt="../../_images/post-processing-content_55_2.png" src="../../_images/post-processing-content_55_2.png" />
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2015, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>